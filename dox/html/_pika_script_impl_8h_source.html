<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PikaScript: /Users/Magnus/projects/PikaScript/src/PikaScriptImpl.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PikaScript</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/Users/Magnus/projects/PikaScript/src/PikaScriptImpl.h</h1>  </div>
</div>
<div class="contents">
<a href="_pika_script_impl_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00042"></a>00042 <span class="preprocessor">#if !defined(PikaScriptImpl_h)</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define PikaScriptImpl_h 0x0100</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#if !defined(PikaScript_h)</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="_pika_script_8h.html" title="PikaScript is a high-level scripting language written in C++.">PikaScript.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#endif</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a>00056 <span class="keyword">namespace </span>Pika {
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T mini(T a, T b) { <span class="keywordflow">return</span> (a &lt; b) ? a : b; }
<a name="l00059"></a>00059 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keyword">inline</span> T maxi(T a, T b) { <span class="keywordflow">return</span> (a &lt; b) ? b : a; }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="comment">// Usually I am pretty militant against macros, but sorry, the following ones are just too handy.</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">// FIX : is there *some* way to solve this without ugly macros? </span>
<a name="l00064"></a>00064 <span class="preprocessor">#if (PIKA_UNICODE)</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span><span class="preprocessor">        #define STR(s) L##s</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">        #define STR(x) x</span>
<a name="l00068"></a>00068 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#define TMPL template&lt;class CFG&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span><span class="preprocessor">#define T_TYPE(x) typename Script&lt;CFG&gt;::x</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>
<a name="l00072"></a>00072 <span class="comment">/* --- Utility Routines --- */</span>
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 <span class="keyword">inline</span> uint uintChar(<span class="keywordtype">char</span> c) { <span class="keywordflow">return</span> uchar(c); }
<a name="l00075"></a>00075 <span class="keyword">inline</span> uint uintChar(<span class="keywordtype">wchar_t</span> c) { <span class="keywordflow">return</span> c; }
<a name="l00076"></a>00076 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt; std::basic_ostream&lt;C&gt;&amp; xcout();
<a name="l00077"></a>00077 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt; std::basic_istream&lt;C&gt;&amp; xcin();
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">inline</span> ulong shiftRight(ulong l, <span class="keywordtype">int</span> r) { <span class="keywordflow">return</span> l &gt;&gt; r; }
<a name="l00080"></a>00080 <span class="keyword">inline</span> ulong shiftLeft(ulong l, <span class="keywordtype">int</span> r) { <span class="keywordflow">return</span> l &lt;&lt; r; }
<a name="l00081"></a>00081 <span class="keyword">inline</span> ulong bitAnd(ulong l, ulong r) { <span class="keywordflow">return</span> l &amp; r; }
<a name="l00082"></a>00082 <span class="keyword">inline</span> ulong bitOr(ulong l, ulong r) { <span class="keywordflow">return</span> l | r; }
<a name="l00083"></a>00083 <span class="keyword">inline</span> ulong bitXor(ulong l, ulong r) { <span class="keywordflow">return</span> l ^ r; }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt; <span class="keyword">inline</span> <span class="keywordtype">bool</span> isSymbolChar(C c) {
<a name="l00086"></a>00086         <span class="keywordflow">return</span> c &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; c &lt;= &#39;z&#39; || c &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; c &lt;= &#39;Z&#39; || c &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; c &lt;= <span class="charliteral">&#39;9&#39;</span> || c == <span class="charliteral">&#39;_&#39;</span> || c == <span class="charliteral">&#39;$&#39;</span>;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="keyword">template</span>&lt;<span class="keyword">class</span> C&gt; <span class="keyword">inline</span> <span class="keywordtype">bool</span> maybeWhite(C c) { <span class="keywordflow">return</span> (c == <span class="charliteral">&#39; &#39;</span> || c == <span class="charliteral">&#39;\t&#39;</span> || c == <span class="charliteral">&#39;\r&#39;</span> || c == <span class="charliteral">&#39;\n&#39;</span> || c == <span class="charliteral">&#39;/&#39;</span>); }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="namespace_pika.html#a8335a5fc0e3c1919a35f14ddb2e347d4">00091</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; std::string toStdString(<span class="keyword">const</span> S&amp; s) { <span class="keywordflow">return</span> std::string(s.begin(), s.end()); }
<a name="l00092"></a>00092 <span class="keyword">template</span>&lt;&gt; std::string toStdString(<span class="keyword">const</span> std::string&amp; s);
<a name="l00093"></a>00093 <span class="keyword">inline</span> std::string&amp; toStdString(std::string&amp; s) { <span class="keywordflow">return</span> s; }
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="namespace_pika.html#a8a2b9bf36956325d436d1d72335a0f60">00095</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; ulong <a class="code" href="namespace_pika.html#a8a2b9bf36956325d436d1d72335a0f60" title="Converts a string in hexadecimal form to an ulong integer.">hexToLong</a>(<span class="keyword">typename</span> S::const_iterator&amp; p, <span class="keyword">const</span> <span class="keyword">typename</span> S::const_iterator&amp; e) {
<a name="l00096"></a>00096         assert(p &lt;= e);
<a name="l00097"></a>00097         ulong l = 0;
<a name="l00098"></a>00098         <span class="keywordflow">for</span> (; p &lt; e &amp;&amp; (*p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= &#39;9&#39; || *p &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; *p &lt;= &#39;F&#39; || *p &gt;= <span class="charliteral">&#39;a&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;f&#39;</span>); ++p)
<a name="l00099"></a>00099                 l = (l &lt;&lt; 4) + (*p &lt;= <span class="charliteral">&#39;9&#39;</span> ? *p - <span class="charliteral">&#39;0&#39;</span> : (*p &amp; ~0x20) - (<span class="charliteral">&#39;A&#39;</span> - 10));
<a name="l00100"></a>00100         <span class="keywordflow">return</span> l;
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="namespace_pika.html#af4491af876eb7ad8880abc99be24c53b">00103</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <span class="keywordtype">long</span> <a class="code" href="namespace_pika.html#af4491af876eb7ad8880abc99be24c53b" title="Converts a string in decimal form to a signed long integer.">stringToLong</a>(<span class="keyword">typename</span> S::const_iterator&amp; p, <span class="keyword">const</span> <span class="keyword">typename</span> S::const_iterator&amp; e) {
<a name="l00104"></a>00104         assert(p &lt;= e);
<a name="l00105"></a>00105         <span class="keywordtype">bool</span> negative = (e - p &gt; 1 &amp;&amp; (*p == <span class="charliteral">&#39;+&#39;</span> || *p == <span class="charliteral">&#39;-&#39;</span>) ? (*p++ == <span class="charliteral">&#39;-&#39;</span>) : <span class="keyword">false</span>);
<a name="l00106"></a>00106         <span class="keywordtype">long</span> l = 0;
<a name="l00107"></a>00107         <span class="keywordflow">for</span> (; p &lt; e &amp;&amp; *p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>; ++p) l = l * 10 + (*p - <span class="charliteral">&#39;0&#39;</span>);
<a name="l00108"></a>00108         <span class="keywordflow">return</span> negative ? -l : l;
<a name="l00109"></a>00109 }
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="namespace_pika.html#a12eb7c1f33df5b94623eafa191f8d360">00111</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S, <span class="keyword">class</span> T&gt; S <a class="code" href="namespace_pika.html#a12eb7c1f33df5b94623eafa191f8d360" title="Converts the integer i to a string with a radix and minimum length of your choice.">intToString</a>(T i, <span class="keywordtype">int</span> radix, <span class="keywordtype">int</span> minLength) {
<a name="l00112"></a>00112         assert(2 &lt;= radix &amp;&amp; radix &lt;= 16);
<a name="l00113"></a>00113         assert(0 &lt;= minLength);
<a name="l00114"></a>00114         <span class="keyword">typename</span> S::value_type buffer[<span class="keyword">sizeof</span> (T) * 8], * p = buffer + <span class="keyword">sizeof</span> (T) * 8, * e = p - minLength;
<a name="l00115"></a>00115         <span class="keywordflow">for</span> (T x = i; p &gt; e || x != 0; x /= radix) {
<a name="l00116"></a>00116                 assert(p &gt;= buffer + 1);
<a name="l00117"></a>00117                 *--p = STR(<span class="stringliteral">&quot;fedcba9876543210123456789abcdef&quot;</span>)[15 + x % radix];                                                                                                  <span class="comment">// Mirrored hex string to handle negative x.</span>
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119         <span class="keywordflow">if</span> (std::numeric_limits&lt;T&gt;::is_signed &amp;&amp; i &lt; 0) *--p = <span class="charliteral">&#39;-&#39;</span>;
<a name="l00120"></a>00120         <span class="keywordflow">return</span> S(p, buffer + <span class="keyword">sizeof</span> (T) * 8 - p);
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42">00123</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <span class="keywordtype">double</span> <a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(<span class="keyword">typename</span> S::const_iterator&amp; p, <span class="keyword">const</span> <span class="keyword">typename</span> S::const_iterator&amp; e) {
<a name="l00124"></a>00124         assert(p &lt;= e);
<a name="l00125"></a>00125         <span class="keywordtype">double</span> d = 0, sign = (e - p &gt; 1 &amp;&amp; (*p == <span class="charliteral">&#39;+&#39;</span> || *p == <span class="charliteral">&#39;-&#39;</span>) ? (*p++ == <span class="charliteral">&#39;-&#39;</span> ? -1.0 : 1.0) : 1.0);
<a name="l00126"></a>00126         <span class="keywordflow">if</span> (std::numeric_limits&lt;double&gt;::has_infinity &amp;&amp; e - p &gt;= 8 &amp;&amp; std::equal(p, p + 8, STR(<span class="stringliteral">&quot;infinity&quot;</span>))) {
<a name="l00127"></a>00127                 p += 8;
<a name="l00128"></a>00128                 d = std::numeric_limits&lt;double&gt;::infinity();
<a name="l00129"></a>00129         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p &lt; e &amp;&amp; *p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>) {
<a name="l00130"></a>00130                 <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;0&#39;</span>) ++p; <span class="keywordflow">else</span> <span class="keywordflow">do</span> { d = d * 10.0 + (*p - <span class="charliteral">&#39;0&#39;</span>); } <span class="keywordflow">while</span> (++p &lt; e &amp;&amp; *p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>);
<a name="l00131"></a>00131                 <span class="keywordflow">if</span> (e - p &gt; 1 &amp;&amp; *p == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; p[1] &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; p[1] &lt;= <span class="charliteral">&#39;9&#39;</span>) {
<a name="l00132"></a>00132                         ++p;
<a name="l00133"></a>00133                         <span class="keywordtype">double</span> f = 1.0;
<a name="l00134"></a>00134                         <span class="keywordflow">do</span> { d += (*p - <span class="charliteral">&#39;0&#39;</span>) * (f *= 0.1); } <span class="keywordflow">while</span> (++p &lt; e &amp;&amp; *p &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *p &lt;= <span class="charliteral">&#39;9&#39;</span>);
<a name="l00135"></a>00135                 }
<a name="l00136"></a>00136                 <span class="keywordflow">if</span> (e - p &gt; 1 &amp;&amp; (*p == <span class="charliteral">&#39;E&#39;</span> || *p == <span class="charliteral">&#39;e&#39;</span>))
<a name="l00137"></a>00137                         d *= pow(10, <span class="keywordtype">double</span>(stringToLong&lt;S&gt;(++p, e)));
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139         <span class="keywordflow">return</span> d * sign;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="namespace_pika.html#aedf7fd36062df252d50441030d318979">00142</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <span class="keywordtype">bool</span> <a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(<span class="keyword">const</span> S&amp; s, <span class="keywordtype">double</span>&amp; d) {
<a name="l00143"></a>00143         <span class="keyword">typename</span> S::const_iterator b = s.begin(), e = s.end(), p = b;
<a name="l00144"></a>00144         d = stringToDouble&lt;S&gt;(p, e);
<a name="l00145"></a>00145         <span class="keywordflow">return</span> (p != b &amp;&amp; p &gt;= e);
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="namespace_pika.html#aeb2ec9013b2d00f63625c6784d1310f6">00148</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; S <a class="code" href="namespace_pika.html#aeb2ec9013b2d00f63625c6784d1310f6" title="Converts the double d to a string (in scientific e notation, e.g. -12.34e-3).">doubleToString</a>(<span class="keywordtype">double</span> d, <span class="keywordtype">int</span> precision) {
<a name="l00149"></a>00149         assert(1 &lt;= precision &amp;&amp; precision &lt;= 24);
<a name="l00150"></a>00150         <span class="keyword">const</span> <span class="keywordtype">double</span> EPSILON = 1.0E-300, SMALL = 1.0E-5, LARGE = 1.0E+10;       
<a name="l00151"></a>00151         <span class="keywordtype">double</span> x = fabs(d), y = x;
<a name="l00152"></a>00152         <span class="keywordflow">if</span> (y &lt; EPSILON) <span class="keywordflow">return</span> S(STR(<span class="stringliteral">&quot;0&quot;</span>));
<a name="l00153"></a>00153         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (precision &gt;= 12 &amp;&amp; y &lt; LARGE &amp;&amp; <span class="keywordtype">long</span>(d) == d) <span class="keywordflow">return</span> intToString&lt;S, long&gt;(long(d));
<a name="l00154"></a>00154         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::numeric_limits&lt;double&gt;::has_infinity &amp;&amp; x == std::numeric_limits&lt;double&gt;::infinity())
<a name="l00155"></a>00155                 <span class="keywordflow">return</span> d &lt; 0 ? S(STR(<span class="stringliteral">&quot;-infinity&quot;</span>)) : S(STR(<span class="stringliteral">&quot;+infinity&quot;</span>));
<a name="l00156"></a>00156         <span class="keyword">typename</span> S::value_type buffer[32], * bp = buffer + 2, * dp = bp, * pp = dp + 1, * ep = pp + precision;
<a name="l00157"></a>00157         <span class="keywordflow">for</span> (; x &gt;= 10.0 &amp;&amp; pp &lt; ep; x *= 0.1) ++pp;                                                                                                                                            <span class="comment">// Normalize values &gt; 10 and move period position.</span>
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (pp &gt;= ep || y &lt;= SMALL || y &gt;= LARGE) {                                                                                                                                                     <span class="comment">// Exponential treatment of very small or large values.</span>
<a name="l00159"></a>00159                 <span class="keywordtype">double</span> e = floor(log10(y) + 1.0E-10);
<a name="l00160"></a>00160                 S exps(e &gt;= 0 ? S(STR(<span class="stringliteral">&quot;e+&quot;</span>)) : S(STR(<span class="stringliteral">&quot;e&quot;</span>)));
<a name="l00161"></a>00161                 exps += intToString&lt;S, int&gt;(int(e));
<a name="l00162"></a>00162                 <span class="keywordtype">int</span> maxp = 15;                                                                                                                                                                                                  <span class="comment">// Limit precision because of rounding errors in log10 etc</span>
<a name="l00163"></a>00163                 <span class="keywordflow">for</span> (<span class="keywordtype">double</span> f = fabs(e); f &gt;= 8; f /= 10) --maxp;
<a name="l00164"></a>00164                 <span class="keywordflow">return</span> (doubleToString&lt;S&gt;(d * pow(0.1, e), mini(maxp, precision)) += exps);
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166         <span class="keywordflow">for</span> (; x &lt; 1.0 &amp;&amp; dp &lt; buffer + 32; ++ep, x *= 10.0) {                                                                                                                          <span class="comment">// For values &lt; 0, spit out leading 0&#39;s and increase precision.</span>
<a name="l00167"></a>00167                 *dp++ = <span class="charliteral">&#39;0&#39;</span>;
<a name="l00168"></a>00168                 <span class="keywordflow">if</span> (dp == pp) *dp++ = <span class="charliteral">&#39;9&#39;</span>;                                                                                                                                                                              <span class="comment">// Hop over period position (set to 9 to avoid when eliminating 9&#39;s).</span>
<a name="l00169"></a>00169         }
<a name="l00170"></a>00170         <span class="keywordflow">for</span> (; dp &lt; ep; ) {                                                                                                                                                                                                     <span class="comment">// Exhaust all remaining digits of mantissa into buffer.</span>
<a name="l00171"></a>00171                 uint ix = uint(x);
<a name="l00172"></a>00172                 *dp++ = ix + <span class="charliteral">&#39;0&#39;</span>;
<a name="l00173"></a>00173                 <span class="keywordflow">if</span> (dp == pp) *dp++ = <span class="charliteral">&#39;9&#39;</span>;                                                                                                                                                                              <span class="comment">// Hop over period position (set to 9 to avoid when eliminating 9&#39;s).</span>
<a name="l00174"></a>00174                 x = (x - ix) * 10.0;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176         <span class="keywordflow">if</span> (x &gt;= 5) {                                                                                                                                                                                                           <span class="comment">// If remainder is &gt;= 5, increment trailing 9&#39;s...</span>
<a name="l00177"></a>00177                 <span class="keywordflow">while</span> (dp[-1] == <span class="charliteral">&#39;9&#39;</span>) *--dp = <span class="charliteral">&#39;0&#39;</span>;
<a name="l00178"></a>00178                 <span class="keywordflow">if</span> (dp == bp) *--bp = <span class="charliteral">&#39;1&#39;</span>; <span class="keywordflow">else</span> dp[-1]++;                                                                                                                                               <span class="comment">// If we are at spare position, set to &#39;1&#39; and include, otherwise, increment last non-9.</span>
<a name="l00179"></a>00179                 <span class="keywordflow">if</span> (dp[-1] == <span class="charliteral">&#39;1&#39;</span>) --ep;                                                                                                                                                                                <span class="comment">// We incremented a 0, cut precision (afterwards, a bit Q&amp;D).</span>
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181         *pp = <span class="charliteral">&#39;.&#39;</span>;
<a name="l00182"></a>00182         <span class="keywordflow">if</span> (ep &gt; pp) <span class="keywordflow">while</span> (ep[-1] == <span class="charliteral">&#39;0&#39;</span>) --ep;
<a name="l00183"></a>00183         <span class="keywordflow">if</span> (ep - 1 == pp) --ep;
<a name="l00184"></a>00184         <span class="keywordflow">if</span> (d &lt; 0) *--bp = <span class="charliteral">&#39;-&#39;</span>; 
<a name="l00185"></a>00185         <span class="keywordflow">return</span> S(bp, ep - bp);
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="keyword">const</span> <span class="keywordtype">int</span> ESCAPE_CODE_COUNT = 10;
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="namespace_pika.html#a20266ad57c9d8c23823e21be3cca4cec">00190</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; S <a class="code" href="namespace_pika.html#a20266ad57c9d8c23823e21be3cca4cec" title="Converts a string that is either enclosed in single (&amp;#39; &amp;#39;) or double (&amp;quot; &amp;quot;) quotes...">unescape</a>(<span class="keyword">typename</span> S::const_iterator&amp; p, <span class="keyword">const</span> <span class="keyword">typename</span> S::const_iterator&amp; e) {
<a name="l00191"></a>00191         assert(p &lt;= e);
<a name="l00192"></a>00192         <span class="keyword">typedef</span> <span class="keyword">typename</span> S::value_type CHAR;
<a name="l00193"></a>00193         <span class="keyword">static</span> <span class="keyword">const</span> CHAR ESCAPE_CHARS[ESCAPE_CODE_COUNT] = { <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;\&quot;&#39;</span>, <span class="charliteral">&#39;\&#39;&#39;</span>,  <span class="charliteral">&#39;a&#39;</span>,  <span class="charliteral">&#39;b&#39;</span>,  <span class="charliteral">&#39;f&#39;</span>,  <span class="charliteral">&#39;n&#39;</span>,  <span class="charliteral">&#39;r&#39;</span>,  <span class="charliteral">&#39;t&#39;</span>,  <span class="charliteral">&#39;v&#39;</span> };
<a name="l00194"></a>00194         <span class="keyword">static</span> <span class="keyword">const</span> CHAR ESCAPE_CODES[ESCAPE_CODE_COUNT] = { <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;\&quot;&#39;</span>, <span class="charliteral">&#39;\&#39;&#39;</span>, <span class="charliteral">&#39;\a&#39;</span>, <span class="charliteral">&#39;\b&#39;</span>, <span class="charliteral">&#39;\f&#39;</span>, <span class="charliteral">&#39;\n&#39;</span>, <span class="charliteral">&#39;\r&#39;</span>, <span class="charliteral">&#39;\t&#39;</span>, <span class="charliteral">&#39;\v&#39;</span> };
<a name="l00195"></a>00195         <span class="keywordflow">if</span> (p &gt;= e || *p != <span class="charliteral">&#39;&quot;&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\&#39;&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="class_pika_1_1_exception.html" title="The PikaScript exception class.">Exception&lt;S&gt;</a>(STR(<span class="stringliteral">&quot;Invalid string literal&quot;</span>));
<a name="l00196"></a>00196         S d;
<a name="l00197"></a>00197         <span class="keyword">typename</span> S::const_iterator b = ++p;
<a name="l00198"></a>00198         <span class="keywordflow">if</span> (p[-1] == <span class="charliteral">&#39;\&#39;&#39;</span>) <span class="keywordflow">while</span> (e - (p = std::find(p, e, <span class="charliteral">&#39;\&#39;&#39;</span>)) &gt; 1 &amp;&amp; p[1] == <span class="charliteral">&#39;\&#39;&#39;</span>) { d += S(b, ++p); b = ++p; }
<a name="l00199"></a>00199         <span class="keywordflow">else</span> <span class="keywordflow">while</span> (p &lt; e &amp;&amp; *p != <span class="charliteral">&#39;\&quot;&#39;</span>) {
<a name="l00200"></a>00200                 <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\\&#39;</span>) {
<a name="l00201"></a>00201                         d += S(b, p);
<a name="l00202"></a>00202                         <span class="keyword">const</span> CHAR* f = std::find(ESCAPE_CHARS, ESCAPE_CHARS + ESCAPE_CODE_COUNT, *++p);
<a name="l00203"></a>00203                         <span class="keywordtype">long</span> l;
<a name="l00204"></a>00204                         <span class="keywordflow">if</span> (f != ESCAPE_CHARS + ESCAPE_CODE_COUNT) { ++p; l = ESCAPE_CODES[f - ESCAPE_CHARS]; }
<a name="l00205"></a>00205                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;x&#39;</span>) { b = ++p; l = hexToLong&lt;S&gt;(p, mini(p + 2, e)); }
<a name="l00206"></a>00206                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;u&#39;</span>) { b = ++p; l = hexToLong&lt;S&gt;(p, mini(p + 4, e)); }
<a name="l00207"></a>00207                         <span class="keywordflow">else</span> { b = p; l = stringToLong&lt;S&gt;(p, e); }
<a name="l00208"></a>00208                         <span class="keywordflow">if</span> (p == b) <span class="keywordflow">throw</span> <a class="code" href="class_pika_1_1_exception.html" title="The PikaScript exception class.">Exception&lt;S&gt;</a>(STR(<span class="stringliteral">&quot;Invalid escape character&quot;</span>));
<a name="l00209"></a>00209                         b = p;
<a name="l00210"></a>00210                         d += CHAR(l);
<a name="l00211"></a>00211                 } <span class="keywordflow">else</span> ++p;
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213         <span class="keywordflow">if</span> (p &gt;= e) <span class="keywordflow">throw</span> <a class="code" href="class_pika_1_1_exception.html" title="The PikaScript exception class.">Exception&lt;S&gt;</a>(STR(<span class="stringliteral">&quot;Unterminated string&quot;</span>));
<a name="l00214"></a>00214         <span class="keywordflow">return</span> (d += S(b, p++));
<a name="l00215"></a>00215 }
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be">00217</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; S <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(<span class="keyword">const</span> S&amp; s) {
<a name="l00218"></a>00218         <span class="keyword">typedef</span> <span class="keyword">typename</span> S::value_type CHAR;
<a name="l00219"></a>00219         <span class="keyword">static</span> <span class="keyword">const</span> CHAR ESCAPE_CHARS[ESCAPE_CODE_COUNT] = { <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;\&quot;&#39;</span>, <span class="charliteral">&#39;\&#39;&#39;</span>,  <span class="charliteral">&#39;a&#39;</span>,  <span class="charliteral">&#39;b&#39;</span>,  <span class="charliteral">&#39;f&#39;</span>,  <span class="charliteral">&#39;n&#39;</span>,  <span class="charliteral">&#39;r&#39;</span>,  <span class="charliteral">&#39;t&#39;</span>,  <span class="charliteral">&#39;v&#39;</span> };
<a name="l00220"></a>00220         <span class="keyword">static</span> <span class="keyword">const</span> CHAR ESCAPE_CODES[ESCAPE_CODE_COUNT] = { <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;\&quot;&#39;</span>, <span class="charliteral">&#39;\&#39;&#39;</span>, <span class="charliteral">&#39;\a&#39;</span>, <span class="charliteral">&#39;\b&#39;</span>, <span class="charliteral">&#39;\f&#39;</span>, <span class="charliteral">&#39;\n&#39;</span>, <span class="charliteral">&#39;\r&#39;</span>, <span class="charliteral">&#39;\t&#39;</span>, <span class="charliteral">&#39;\v&#39;</span> };
<a name="l00221"></a>00221         <span class="keyword">typename</span> S::const_iterator b = s.begin(), e = s.end();
<a name="l00222"></a>00222         <span class="keywordtype">bool</span> needToBackUp = <span class="keyword">false</span>;                                                                                                                                                                                              <span class="comment">// If we need to re-escape with &quot; &quot; and string contained &quot; or \ we need to start over from the beginning.</span>
<a name="l00223"></a>00223         <span class="keywordflow">for</span> (; b &lt; e &amp;&amp; *b &gt;= 32 &amp;&amp; *b &lt;= 126 &amp;&amp; *b != <span class="charliteral">&#39;\&#39;&#39;</span>; ++b) needToBackUp = needToBackUp || (*b == <span class="charliteral">&#39;\\&#39;</span> || *b == <span class="charliteral">&#39;\&quot;&#39;</span>);
<a name="l00224"></a>00224         <span class="keywordflow">if</span> (b &gt;= e) <span class="keywordflow">return</span> ((S(STR(<span class="stringliteral">&quot;&#39;&quot;</span>)) += s) += <span class="charliteral">&#39;\&#39;&#39;</span>);
<a name="l00225"></a>00225         <span class="keywordflow">if</span> (needToBackUp) b = s.begin();
<a name="l00226"></a>00226         <span class="keyword">typename</span> S::const_iterator l = s.begin();
<a name="l00227"></a>00227         S d = S(STR(<span class="stringliteral">&quot;\&quot;&quot;</span>));
<a name="l00228"></a>00228         <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
<a name="l00229"></a>00229                 <span class="keywordflow">while</span> (b &lt; e &amp;&amp; *b &gt;= 32 &amp;&amp; *b &lt;= 126 &amp;&amp; *b != <span class="charliteral">&#39;\\&#39;</span> &amp;&amp; *b != <span class="charliteral">&#39;\&quot;&#39;</span>) ++b;
<a name="l00230"></a>00230                 d += S(l, b);
<a name="l00231"></a>00231                 <span class="keywordflow">if</span> (b &gt;= e) <span class="keywordflow">break</span>;
<a name="l00232"></a>00232                 <span class="keyword">const</span> CHAR* f = std::find(ESCAPE_CODES, ESCAPE_CODES + ESCAPE_CODE_COUNT, *b);
<a name="l00233"></a>00233                 <span class="keywordflow">if</span> (f != ESCAPE_CODES + ESCAPE_CODE_COUNT) (d += <span class="charliteral">&#39;\\&#39;</span>) += ESCAPE_CHARS[f - ESCAPE_CODES];
<a name="l00234"></a>00234                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uintChar(*b) == uintChar(*b)) (d += STR(<span class="stringliteral">&quot;\\x&quot;</span>)) += intToString&lt;S&gt;(uintChar(*b), 16, 2);
<a name="l00235"></a>00235                 <span class="keywordflow">else</span> (d += STR(<span class="stringliteral">&quot;\\u&quot;</span>)) += intToString&lt;S&gt;(uintChar(*b), 16, 4);
<a name="l00236"></a>00236                 l = ++b;
<a name="l00237"></a>00237         }
<a name="l00238"></a>00238         <span class="keywordflow">return</span> (d += <span class="charliteral">&#39;\&quot;&#39;</span>);
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="comment">/* --- STLValue --- */</span>
<a name="l00242"></a>00242 
<a name="l00243"></a><a class="code" href="class_pika_1_1_s_t_l_value.html#a9f5c320279c7fde403e3840a6f452ed8">00243</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <a class="code" href="class_pika_1_1_s_t_l_value.html#a9f5c320279c7fde403e3840a6f452ed8" title="Converts the value to a boolean.">STLValue&lt;S&gt;::operator bool</a>()<span class="keyword"> const </span>{
<a name="l00244"></a>00244         <span class="keywordflow">if</span> (S(*<span class="keyword">this</span>) == STR(<span class="stringliteral">&quot;false&quot;</span>)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00245"></a>00245         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (S(*<span class="keyword">this</span>) == STR(<span class="stringliteral">&quot;true&quot;</span>)) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00246"></a>00246         <span class="keywordflow">else</span> <span class="keywordflow">throw</span> <a class="code" href="class_pika_1_1_exception.html" title="The PikaScript exception class.">Exception&lt;S&gt;</a>(S(STR(<span class="stringliteral">&quot;Invalid boolean: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(S(*<span class="keyword">this</span>)));
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a><a class="code" href="class_pika_1_1_s_t_l_value.html#a62b9cf5e3c3b8f655a31b78f1db6d339">00249</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <a class="code" href="class_pika_1_1_s_t_l_value.html#a62b9cf5e3c3b8f655a31b78f1db6d339" title="Converts the value to a signed long integer.">STLValue&lt;S&gt;::operator long</a>()<span class="keyword"> const </span>{
<a name="l00250"></a>00250         <span class="keyword">typename</span> S::const_iterator p = S::begin();
<a name="l00251"></a>00251         <span class="keywordtype">long</span> y = stringToLong&lt;S&gt;(p, S::end());
<a name="l00252"></a>00252         <span class="keywordflow">if</span> (p == S::begin() || p &lt; S::end()) throw Exception&lt;S&gt;(S(STR(<span class="stringliteral">&quot;Invalid integer: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(S(*<span class="keyword">this</span>)));
<a name="l00253"></a>00253         <span class="keywordflow">return</span> y;
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="class_pika_1_1_s_t_l_value.html#af95493dc0adfd167c65be3067c902197">00256</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <a class="code" href="class_pika_1_1_s_t_l_value.html#af95493dc0adfd167c65be3067c902197" title="Converts the value to a double precision floating point.">STLValue&lt;S&gt;::operator double</a>()<span class="keyword"> const </span>{
<a name="l00257"></a>00257         <span class="keywordtype">double</span> d;
<a name="l00258"></a>00258         <span class="keywordflow">if</span> (!<a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(*<span class="keyword">this</span>, d)) <span class="keywordflow">throw</span> <a class="code" href="class_pika_1_1_exception.html" title="The PikaScript exception class.">Exception&lt;S&gt;</a>(S(STR(<span class="stringliteral">&quot;Invalid number: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(S(*<span class="keyword">this</span>)));
<a name="l00259"></a>00259         <span class="keywordflow">return</span> d;
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a><a class="code" href="class_pika_1_1_s_t_l_value.html#aa584aed1dd2d14024cb2ab340d154901">00262</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <span class="keywordtype">bool</span> <a class="code" href="class_pika_1_1_s_t_l_value.html#aa584aed1dd2d14024cb2ab340d154901" title="Less than comparison operator.">STLValue&lt;S&gt;::operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="class_pika_1_1_s_t_l_value.html" title="STLValue is the reference implementation of a PikaScript variable.">STLValue</a>&amp; r)<span class="keyword"> const </span>{
<a name="l00263"></a>00263         <span class="keywordtype">double</span> lv, rv;
<a name="l00264"></a>00264         <span class="keywordtype">bool</span> lnum = <a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(*<span class="keyword">this</span>, lv), rnum = <a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(r, rv);
<a name="l00265"></a>00265         <span class="keywordflow">return</span> (lnum == rnum ? (lnum ? lv &lt; rv : (<span class="keyword">const</span> S&amp;)(*<span class="keyword">this</span>) &lt; (<span class="keyword">const</span> S&amp;)(r)) : lnum);
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="class_pika_1_1_s_t_l_value.html#a79842216ad6e1e42455bd79ff4988a22">00268</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <span class="keywordtype">bool</span> <a class="code" href="class_pika_1_1_s_t_l_value.html#a79842216ad6e1e42455bd79ff4988a22" title="Equality operator.">STLValue&lt;S&gt;::operator==</a>(<span class="keyword">const</span> <a class="code" href="class_pika_1_1_s_t_l_value.html" title="STLValue is the reference implementation of a PikaScript variable.">STLValue</a>&amp; r)<span class="keyword"> const </span>{
<a name="l00269"></a>00269         <span class="keywordtype">double</span> lv, rv;
<a name="l00270"></a>00270         <span class="keywordtype">bool</span> lnum = <a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(*<span class="keyword">this</span>, lv), rnum = <a class="code" href="namespace_pika.html#ac9a32b5533f16c0e81550ab85dcc9e42" title="Converts a string in scientific e notation (e.g. -12.34e-3) to a double floating point value...">stringToDouble</a>(r, rv);
<a name="l00271"></a>00271         <span class="keywordflow">return</span> (lnum == rnum &amp;&amp; (lnum ? lv == rv : (<span class="keyword">const</span> S&amp;)(*<span class="keyword">this</span>) == (<span class="keyword">const</span> S&amp;)(r)));
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="class_pika_1_1_s_t_l_value.html#ad97f3f7e7d70de7ff5da5011d3197d6e">00274</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> S&gt; <span class="keyword">const</span> <a class="code" href="class_pika_1_1_s_t_l_value.html" title="STLValue is the reference implementation of a PikaScript variable.">STLValue&lt;S&gt;</a> <a class="code" href="class_pika_1_1_s_t_l_value.html#ad97f3f7e7d70de7ff5da5011d3197d6e" title="The subscript operator returns the concatenation of the value with the dot (.) separator (if necessar...">STLValue&lt;S&gt;::operator[]</a>(<span class="keyword">const</span> <a class="code" href="class_pika_1_1_s_t_l_value.html" title="STLValue is the reference implementation of a PikaScript variable.">STLValue</a>&amp; i)<span class="keyword"> const </span>{
<a name="l00275"></a>00275         <span class="keyword">typename</span> S::const_iterator b = S::begin(), p = S::end();
<a name="l00276"></a>00276         <span class="keywordflow">if</span> (p &gt; b) <span class="keywordflow">switch</span> (*(p - 1)) {
<a name="l00277"></a>00277                 <span class="keywordflow">case</span> <span class="charliteral">&#39;$&#39;</span>:       <span class="keywordflow">if</span> (--p == b) <span class="keywordflow">break</span>; <span class="comment">/* else continue */</span>
<a name="l00278"></a>00278                 <span class="keywordflow">case</span> <span class="charliteral">&#39;^&#39;</span>:       <span class="keywordflow">while</span> (p &gt; b &amp;&amp; *(p - 1) == <span class="charliteral">&#39;^&#39;</span>) --p; <span class="keywordflow">if</span> (p == b) <span class="keywordflow">break</span>; <span class="comment">/* else continue */</span>
<a name="l00279"></a>00279                 <span class="keywordflow">case</span> <span class="charliteral">&#39;:&#39;</span>:       <span class="keywordflow">if</span> (p - 1 &gt; b &amp;&amp; *(p - 1) == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; *b == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; std::find(b + 1, p, <span class="charliteral">&#39;:&#39;</span>) == p - 1) p = b; <span class="keywordflow">break</span>;
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281         <span class="keywordflow">return</span> (p == b) ? S(*<span class="keyword">this</span>) + S(i) : (S(*<span class="keyword">this</span>) + STR(<span class="charliteral">&#39;.&#39;</span>)) += S(i);
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284 <span class="comment">/* --- Frame --- */</span>
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="class_pika_1_1_script_1_1_frame.html#a2cdc862c1c8c5f4aabe49a70e643495a">00286</a> TMPL <a class="code" href="class_pika_1_1_script_1_1_frame.html#a2cdc862c1c8c5f4aabe49a70e643495a" title="Constructs the Frame and associates it with the variable space vars.">Script&lt;CFG&gt;::Frame::Frame</a>(<a class="code" href="class_pika_1_1_script_1_1_variables.html" title="Variables is an abstract base class which implements the interface to the variable space that a Frame...">Variables</a>&amp; vars, <a class="code" href="class_pika_1_1_script_1_1_root.html" title="The Root is the first Frame you instantiate.">Root</a>&amp; root, <a class="code" href="class_pika_1_1_script_1_1_frame.html" title="The execution context and interpreter for PikaScript.">Frame</a>* previous) : vars(vars), root(root)
<a name="l00287"></a>00287                 , previous(previous), closure(this), label(previous == 0 ? <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;::&quot;</span>)) : root.generateLabel()) { }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script</a>&lt;CFG&gt;::<a class="code" href="class_pika_1_1_script_1_1_frame.html" title="The execution context and interpreter for PikaScript.">Frame</a>::rvalue(const XValue&amp; v, <span class="keywordtype">bool</span> fallback) {
<a name="l00290"></a>00290         <span class="keywordflow">return</span> !v.first ? v.second : <span class="keyword">get</span>(v.second, fallback);
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 TMPL <span class="keyword">const</span> T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>)&amp; <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Frame::lvalue</a>(<span class="keyword">const</span> XValue&amp; v) {
<a name="l00294"></a>00294         <span class="keywordflow">if</span> (!v.first) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Invalid lvalue&quot;</span>));
<a name="l00295"></a>00295         <span class="keywordflow">return</span> v.second;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 TMPL T_TYPE(Frame*) Script&lt;CFG&gt;::Frame::resolveFrame(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, const <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e)<span class="keyword"> const </span>{
<a name="l00299"></a>00299         assert(p &lt;= e);
<a name="l00300"></a>00300         Frame* f = <span class="keyword">const_cast&lt;</span>Frame*<span class="keyword">&gt;</span>(<span class="keyword">this</span>);
<a name="l00301"></a>00301         <span class="keywordflow">if</span> (p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;:&#39;</span>) {
<a name="l00302"></a>00302                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> n = std::find(p + 1, e, <span class="charliteral">&#39;:&#39;</span>);
<a name="l00303"></a>00303                 <span class="keywordflow">if</span> (n &gt;= e) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Invalid identifier: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(p, e)));
<a name="l00304"></a>00304                 <span class="keywordflow">if</span> (n - p &gt; 1) {
<a name="l00305"></a>00305                         <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> s(p, n + 1);
<a name="l00306"></a>00306                         <span class="keywordflow">while</span> (f-&gt;label != s)
<a name="l00307"></a>00307                                 <span class="keywordflow">if</span> ((f = f-&gt;previous) == 0) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Frame does not exist: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(s));
<a name="l00308"></a>00308                 } <span class="keywordflow">else</span> f = &amp;root;
<a name="l00309"></a>00309                 p = n + 1;
<a name="l00310"></a>00310         }
<a name="l00311"></a>00311         <span class="keywordflow">for</span> (; p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;^&#39;</span>; ++p)
<a name="l00312"></a>00312                 <span class="keywordflow">if</span> ((f = f-&gt;previous) == 0) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Frame does not exist&quot;</span>));
<a name="l00313"></a>00313         <span class="keywordflow">if</span> (p &gt;= e || *p != <span class="charliteral">&#39;$&#39;</span>) f = f-&gt;closure;
<a name="l00314"></a>00314         <span class="keywordflow">return</span> f;
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 TMPL std::pair&lt; T_TYPE(Frame*), T_TYPE(String) &gt; <a class="code" href="class_pika_1_1_script_1_1_frame.html#a069906eb269cc309dacc01c8d044c36f" title="Resolves the frame for identifier and returns it together with identifier stripped of any prefixed &amp;q...">Script&lt;CFG&gt;::Frame::resolveFrame</a>(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier)<span class="keyword"> const </span>{
<a name="l00318"></a>00318         <span class="keywordflow">switch</span> (identifier[0]) {
<a name="l00319"></a>00319                 <span class="keywordflow">case</span> <span class="charliteral">&#39;$&#39;</span>:       <span class="keywordflow">return</span> std::pair&lt;Frame*, String&gt;(<span class="keyword">const_cast&lt;</span>Frame*<span class="keyword">&gt;</span>(<span class="keyword">this</span>), identifier);
<a name="l00320"></a>00320                 <span class="keywordflow">case</span> <span class="charliteral">&#39;:&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;^&#39;</span>: {
<a name="l00321"></a>00321                         <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> b = <span class="keyword">const_cast&lt;</span><span class="keyword">const </span><a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp;<span class="keyword">&gt;</span>(identifier).begin(), e = <span class="keyword">const_cast&lt;</span><span class="keyword">const </span><a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp;<span class="keyword">&gt;</span>(identifier).end();
<a name="l00322"></a>00322                         Frame* frame = resolveFrame(b, e);
<a name="l00323"></a>00323                         <span class="keywordflow">return</span> std::pair&lt;Frame*, String&gt;(frame, <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, e));
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325                 <span class="keywordflow">default</span>:        <span class="keywordflow">return</span> std::pair&lt;Frame*, String&gt;(closure, identifier);
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327 }
<a name="l00328"></a>00328 
<a name="l00329"></a>00329 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::Frame::get(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier, <span class="keywordtype">bool</span> fallback)<span class="keyword"> const </span>{
<a name="l00330"></a>00330         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> temp;
<a name="l00331"></a>00331         std::pair&lt;Frame*, String&gt; fs = resolveFrame(identifier);
<a name="l00332"></a>00332         <span class="keywordflow">if</span> (fs.first-&gt;vars.lookup(fs.second, temp)) <span class="keywordflow">return</span> temp;
<a name="l00333"></a>00333         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fallback &amp;&amp; isSymbolChar(identifier[0]) &amp;&amp; root.vars.lookup(fs.second, temp)) <span class="keywordflow">return</span> temp;
<a name="l00334"></a>00334         <span class="keywordflow">else</span> <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Undefined: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(identifier));
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::Frame::getOptional(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier, const <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>&amp; defaultValue)<span class="keyword"> const </span>{
<a name="l00338"></a>00338         std::pair&lt;Frame*, String&gt; fs = resolveFrame(identifier);
<a name="l00339"></a>00339         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> temp;
<a name="l00340"></a>00340         <span class="keywordflow">return</span> fs.first-&gt;vars.lookup(fs.second, temp) ? temp : defaultValue;
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 TMPL <span class="keyword">const</span> T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>)&amp; <a class="code" href="class_pika_1_1_script_1_1_frame.html#a79d6f79cfb915910c85857eacc88bd57" title="Sets a variable value.">Script&lt;CFG&gt;::Frame::set</a>(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>&amp; v) {
<a name="l00344"></a>00344         std::pair&lt;Frame*, String&gt; fs = resolveFrame(identifier);
<a name="l00345"></a>00345         <span class="keywordflow">if</span> (!fs.first-&gt;vars.assign(fs.second, v)) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Cannot modify: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(identifier));
<a name="l00346"></a>00346         <span class="keywordflow">return</span> v;
<a name="l00347"></a>00347 }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::Frame::reference(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier)<span class="keyword"> const </span>{
<a name="l00350"></a>00350         std::pair&lt;Frame*, String&gt; fs = resolveFrame(identifier);
<a name="l00351"></a>00351         <span class="keywordflow">return</span> fs.first-&gt;label + fs.second;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::Frame::execute(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; body) {
<a name="l00355"></a>00355         <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> b = body.begin(), e = body.end();
<a name="l00356"></a>00356         <span class="keywordflow">switch</span> (b &lt; e ? *b : 0) {
<a name="l00357"></a>00357                 <span class="keywordflow">case</span> <span class="charliteral">&#39;{&#39;</span>:       <span class="keywordflow">return</span> evaluate(body);                                                                                                                                                          <span class="comment">// &lt;-- function</span>
<a name="l00358"></a>00358                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&gt;&#39;</span>:       closure = resolveFrame(++b, e);                                                                                                                                         <span class="comment">// &lt;-- lambda</span>
<a name="l00359"></a>00359                                         <span class="keywordflow">return</span> evaluate(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, e));
<a name="l00360"></a>00360                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&lt;&#39;</span>:       <span class="keywordflow">if</span> (--e - ++b &gt; 0) {                                                                                                                                                            <span class="comment">// &lt;-- native</span>
<a name="l00361"></a>00361                                                 Frame* nativeFrame = (*b == <span class="charliteral">&#39;:&#39;</span> ? resolveFrame(b, e) : &amp;root);
<a name="l00362"></a>00362                                                 Native* native = nativeFrame-&gt;vars.lookupNative(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, e));
<a name="l00363"></a>00363                                                 <span class="keywordflow">if</span> (native != 0) <span class="keywordflow">return</span> native-&gt;pikaCall(*<span class="keyword">this</span>);
<a name="l00364"></a>00364                                         }
<a name="l00365"></a>00365                                         <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Unknown native function: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(body));
<a name="l00366"></a>00366                 <span class="keywordflow">default</span>:        <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Illegal call on: &quot;</span>)) + <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(body));
<a name="l00367"></a>00367         }
<a name="l00368"></a>00368 }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::Frame::white(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e) {
<a name="l00371"></a>00371         assert(p &lt;= e);
<a name="l00372"></a>00372         <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00373"></a>00373                 <span class="keywordflow">switch</span> (*p) {
<a name="l00374"></a>00374                         <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\t&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\r&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\n&#39;</span>: ++p; <span class="keywordflow">break</span>;
<a name="l00375"></a>00375                         <span class="keywordflow">case</span> <span class="charliteral">&#39;/&#39;</span>:       <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;/&#39;</span>) {
<a name="l00376"></a>00376                                                         <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a> END_CHARS[] = { <span class="charliteral">&#39;\r&#39;</span>, <span class="charliteral">&#39;\n&#39;</span> };
<a name="l00377"></a>00377                                                         p = std::find_first_of(p += 2, e, END_CHARS, END_CHARS + 2);
<a name="l00378"></a>00378                                                         <span class="keywordflow">break</span>;
<a name="l00379"></a>00379                                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;*&#39;</span>) {
<a name="l00380"></a>00380                                                         <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a> END_CHARS[] = { <span class="charliteral">&#39;*&#39;</span>, <span class="charliteral">&#39;/&#39;</span> };
<a name="l00381"></a>00381                                                         p = std::search(p += 2, e, END_CHARS, END_CHARS + 2);
<a name="l00382"></a>00382                                                         <span class="keywordflow">if</span> (p &gt;= e) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Missing &#39;*/&#39;&quot;</span>));
<a name="l00383"></a>00383                                                         p += 2;
<a name="l00384"></a>00384                                                         <span class="keywordflow">break</span>;
<a name="l00385"></a>00385                                                 } <span class="comment">/* else continue */</span>
<a name="l00386"></a>00386                         <span class="keywordflow">default</span>:        <span class="keywordflow">return</span>;
<a name="l00387"></a>00387                 }
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::token(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a>* token) {
<a name="l00392"></a>00392         assert(p &lt;= e);
<a name="l00393"></a>00393         <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> t = p + 1;
<a name="l00394"></a>00394         <span class="keywordflow">while</span> (*token != 0 &amp;&amp; t &lt; e &amp;&amp; *t == *token) { ++t; ++token; }
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (*token == 0 &amp;&amp; (t &gt;= e || !isSymbolChar(*t))) {
<a name="l00396"></a>00396                 <span class="keywordflow">if</span> ((p = t) &lt; e &amp;&amp; maybeWhite(*p)) white(p, e);
<a name="l00397"></a>00397                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00398"></a>00398         } <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 TMPL <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt; <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::binaryOp(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> dry
<a name="l00402"></a>00402                 , <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres, <span class="keywordtype">int</span> hop, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> prec, F op) {
<a name="l00403"></a>00403         assert(p &lt;= e);
<a name="l00404"></a>00404         assert(hop &gt;= 0);
<a name="l00405"></a>00405         <span class="keywordflow">if</span> (thres &gt;= prec) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00406"></a>00406         XValue r;
<a name="l00407"></a>00407         expr(p += hop, e, r, <span class="keyword">false</span>, dry, prec);
<a name="l00408"></a>00408         <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, op(rvalue(v), rvalue(r)));
<a name="l00409"></a>00409         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00410"></a>00410 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 TMPL <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt; <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::assignableOp(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> dry
<a name="l00413"></a>00413                 , <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres, <span class="keywordtype">int</span> hop, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> prec, F op) {
<a name="l00414"></a>00414         assert(p &lt;= e);
<a name="l00415"></a>00415         assert(hop &gt;= 0);
<a name="l00416"></a>00416         <span class="keywordflow">if</span> (p + hop &gt;= e || p[hop] != <span class="charliteral">&#39;=&#39;</span>) <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, hop, prec, op);
<a name="l00417"></a>00417         <span class="keywordflow">if</span> (thres &gt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a61d4ad888ea9cb5bb0237cd8a3b62b45" title="x=y x*=y x/=y x\=y x=y x+=y x-=y x&amp;lt;&amp;lt;=y x&amp;gt;&amp;gt;=y x#=y x&amp;amp;=y x^=y x|=y">ASSIGN</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00418"></a>00418         XValue r;                                                                                                                                                                                                                       <span class="comment">// &lt;-- operate and assign</span>
<a name="l00419"></a>00419         expr(p += hop + 1, e, r, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a61d4ad888ea9cb5bb0237cd8a3b62b45" title="x=y x*=y x/=y x\=y x=y x+=y x-=y x&amp;lt;&amp;lt;=y x&amp;gt;&amp;gt;=y x#=y x&amp;amp;=y x^=y x|=y">ASSIGN</a>);
<a name="l00420"></a>00420         <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <span class="keyword">set</span>(lvalue(v), op(rvalue(v, <span class="keyword">false</span>), rvalue(r))));
<a name="l00421"></a>00421         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 TMPL <span class="keyword">template</span>&lt;<span class="keyword">class</span> F&gt; <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::addSubOp(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> dry
<a name="l00425"></a>00425                 , <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres, <span class="keyword">const</span> F&amp; f) {
<a name="l00426"></a>00426         assert(p &lt;= e);
<a name="l00427"></a>00427         <span class="keywordflow">if</span> (p + 1 &gt;= e || p[1] != *p) <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a1f6836b2ffa0bfdb9d66c9f771c543b7" title="x+y x-y">ADD_SUB</a>, f);
<a name="l00428"></a>00428         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thres &gt;= <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a719f62687a31133a1acf74172e5cb5b7" title="x() x.y x[y] x{y} x++ x--">POSTFIX</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00429"></a>00429         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dry) {
<a name="l00430"></a>00430                 <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> r = rvalue(v, <span class="keyword">false</span>);                                                                                                                                                                             <span class="comment">// &lt;-- post inc/dec</span>
<a name="l00431"></a>00431                 <span class="keyword">set</span>(lvalue(v), f(<span class="keywordtype">long</span>(r), 1));
<a name="l00432"></a>00432                 v = XValue(<span class="keyword">false</span>, r);
<a name="l00433"></a>00433         }
<a name="l00434"></a>00434         p += 2;
<a name="l00435"></a>00435         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 TMPL <span class="keyword">template</span>&lt;<span class="keyword">class</span> E, <span class="keyword">class</span> I, <span class="keyword">class</span> S&gt; <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::lgtOp(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v
<a name="l00439"></a>00439                 , <span class="keywordtype">bool</span> dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres, <span class="keyword">const</span> E&amp; excl, <span class="keyword">const</span> I&amp; incl, S shift) {
<a name="l00440"></a>00440         assert(p &lt;= e);
<a name="l00441"></a>00441         assert(shift &gt;= 0);
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == *p) <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 2, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ae72c8c4a8f21bd24550184837bc8cc5e" title="x&amp;lt;&amp;lt;y x&amp;gt;&amp;gt;y">SHIFT</a>, shift);                                                         <span class="comment">// &lt;-- shift</span>
<a name="l00443"></a>00443         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;=&#39;</span>) <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, 2, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab0fb7f4ddcbcab9bf817a6fb2347e758" title="x&amp;lt;y x&amp;lt;=y x&amp;gt;y x&amp;gt;=y">COMPARE</a>, incl);                                                      <span class="comment">// &lt;-- less/greater or equal</span>
<a name="l00444"></a>00444         <span class="keywordflow">else</span> <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab0fb7f4ddcbcab9bf817a6fb2347e758" title="x&amp;lt;y x&amp;lt;=y x&amp;gt;y x&amp;gt;=y">COMPARE</a>, excl);                                                                                                            <span class="comment">// &lt;-- less/greater</span>
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::pre(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> dry) {
<a name="l00448"></a>00448         assert(p &lt;= e);
<a name="l00449"></a>00449         <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> b = p; 
<a name="l00450"></a>00450         <span class="keywordflow">switch</span> (p &lt; e ? *p : 0) {
<a name="l00451"></a>00451                 <span class="keywordflow">case</span> 0:         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00452"></a>00452                 <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>:       expr(++p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab8ed7b2971e18d723f66bb1d520714c2" title="@x !x ~x +x -x ++x --x">PREFIX</a>); <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, !rvalue(v)); <span class="keywordflow">return</span> <span class="keyword">true</span>;                      <span class="comment">// &lt;-- logical not</span>
<a name="l00453"></a>00453                 <span class="keywordflow">case</span> <span class="charliteral">&#39;~&#39;</span>:       expr(++p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab8ed7b2971e18d723f66bb1d520714c2" title="@x !x ~x +x -x ++x --x">PREFIX</a>); <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, ~ulong(rvalue(v))); <span class="keywordflow">return</span> <span class="keyword">true</span>;       <span class="comment">// &lt;-- bitwise not</span>
<a name="l00454"></a>00454                 <span class="keywordflow">case</span> <span class="charliteral">&#39;(&#39;</span>:       termExpr(++p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab4c72877103485cfeef038e0dbe8cfb3" title="(x) [x]">BRACKETS</a>, <span class="charliteral">&#39;)&#39;</span>); <span class="keywordflow">return</span> <span class="keyword">true</span>;                                                                            <span class="comment">// &lt;-- parenthesis</span>
<a name="l00455"></a>00455                 <span class="keywordflow">case</span> <span class="charliteral">&#39;:&#39;</span>:       <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;:&#39;</span>) p += 2; <span class="keywordflow">break</span>;                                                                                                            <span class="comment">// &lt;-- root</span>
<a name="l00456"></a>00456                 <span class="keywordflow">case</span> <span class="charliteral">&#39;^&#39;</span>:       <span class="keywordflow">while</span> (++p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;^&#39;</span>); <span class="keywordflow">break</span>;                                                                                                                            <span class="comment">// &lt;-- frame peek</span>
<a name="l00457"></a>00457                 <span class="keywordflow">case</span> <span class="charliteral">&#39;@&#39;</span>:       expr(++p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab8ed7b2971e18d723f66bb1d520714c2" title="@x !x ~x +x -x ++x --x">PREFIX</a>); <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, reference(lvalue(v))); <span class="keywordflow">return</span> <span class="keyword">true</span>;<span class="comment">// &lt;-- reference</span>
<a name="l00458"></a>00458                 <span class="keywordflow">case</span> <span class="charliteral">&#39;[&#39;</span>:       termExpr(++p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab4c72877103485cfeef038e0dbe8cfb3" title="(x) [x]">BRACKETS</a>, <span class="charliteral">&#39;]&#39;</span>); <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">true</span>, rvalue(v)); <span class="keywordflow">return</span> <span class="keyword">true</span>;     <span class="comment">// &lt;-- indirection</span>
<a name="l00459"></a>00459                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&lt;&#39;</span>:       p = std::find(p, e, <span class="charliteral">&#39;&gt;&#39;</span>); <span class="keywordflow">if</span> (p &lt; e) ++p; <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, p)); <span class="keywordflow">return</span> <span class="keyword">true</span>;       <span class="comment">// &lt;-- native literal</span>
<a name="l00460"></a>00460                 <span class="keywordflow">case</span> <span class="charliteral">&#39;\&#39;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>: { <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> s(unescape&lt;String&gt;(p, e)); <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, s); } <span class="keywordflow">return</span> <span class="keyword">true</span>;                  <span class="comment">// &lt;-- string literal</span>
<a name="l00461"></a>00461                 <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:       <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;lse&quot;</span>))) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Unexpected &#39;else&#39; (preceded by &#39;;&#39;?)&quot;</span>)); <span class="keywordflow">break</span>;        <span class="comment">// &lt;-- error on unexpected else</span>
<a name="l00462"></a>00462                 <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:       <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;rue&quot;</span>))) { <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <span class="keyword">true</span>); <span class="keywordflow">return</span> <span class="keyword">true</span>; } <span class="keywordflow">break</span>;                         <span class="comment">// &lt;-- true literal</span>
<a name="l00463"></a>00463                 <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:       <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;oid&quot;</span>))) { <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>()); <span class="keywordflow">return</span> <span class="keyword">true</span>; } <span class="keywordflow">break</span>;                      <span class="comment">// &lt;-- void literal</span>
<a name="l00464"></a>00464                 
<a name="l00465"></a>00465                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&gt;&#39;</span>:       <span class="keywordflow">if</span> (++p &lt; e &amp;&amp; maybeWhite(*p)) white(p, e);                                                                                                                     <span class="comment">// &lt;-- lambda</span>
<a name="l00466"></a>00466                                         b = p;
<a name="l00467"></a>00467                                         expr(p, e, v, <span class="keyword">false</span>, <span class="keyword">true</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ac3d6d16da3d35c2ce90122057f3a0581" title="x; y;">STATEMENT</a>);
<a name="l00468"></a>00468                                         <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, (<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;&gt;&quot;</span>)) += closure-&gt;label) += <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, p));
<a name="l00469"></a>00469                                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471                 <span class="keywordflow">case</span> <span class="charliteral">&#39;{&#39;</span>:       <span class="keywordflow">do</span> { expr(++p, e, v, <span class="keyword">true</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ac3d6d16da3d35c2ce90122057f3a0581" title="x; y;">STATEMENT</a>); } <span class="keywordflow">while</span> (p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;;&#39;</span>);                                                       <span class="comment">// &lt;-- compound</span>
<a name="l00472"></a>00472                                         <span class="keywordflow">if</span> (p &gt;= e) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Missing &#39;}&#39;&quot;</span>));
<a name="l00473"></a>00473                                         <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;}&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Syntax error (missing &#39;;&#39;)?&quot;</span>));
<a name="l00474"></a>00474                                         ++p;
<a name="l00475"></a>00475                                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00476"></a>00476                 
<a name="l00477"></a>00477                 <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>:
<a name="l00478"></a>00478                                         <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;infinity&quot;</span>))) p = b + 1; <span class="comment">/* and continue to stringToDouble */</span>                                       <span class="comment">// &lt;-- infinity literal</span>
<a name="l00479"></a>00479                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (++p &gt;= e) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00480"></a>00480                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == *b) {
<a name="l00481"></a>00481                                                 expr(++p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab8ed7b2971e18d723f66bb1d520714c2" title="@x !x ~x +x -x ++x --x">PREFIX</a>);                                                                                                                    <span class="comment">// &lt;-- pre inc/dec</span>
<a name="l00482"></a>00482                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <span class="keyword">set</span>(lvalue(v), <span class="keywordtype">long</span>(rvalue(v, <span class="keyword">false</span>)) + (*b == <span class="charliteral">&#39;-&#39;</span> ? -1 : 1)));
<a name="l00483"></a>00483                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00484"></a>00484                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p &lt; &#39;0&#39; || *p &gt; <span class="charliteral">&#39;9&#39;</span>) {
<a name="l00485"></a>00485                                                 expr(p, e, v, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab8ed7b2971e18d723f66bb1d520714c2" title="@x !x ~x +x -x ++x --x">PREFIX</a>);                                                                                                                              <span class="comment">// &lt;-- positive / negative</span>
<a name="l00486"></a>00486                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, *b == <span class="charliteral">&#39;-&#39;</span> ? -<span class="keywordtype">double</span>(rvalue(v)) : <span class="keywordtype">double</span>(rvalue(v)));
<a name="l00487"></a>00487                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00488"></a>00488                                         } <span class="comment">/* else continue */</span>
<a name="l00489"></a>00489                                                         
<a name="l00490"></a>00490                 <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>:       <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;x&#39;</span>) {
<a name="l00491"></a>00491                                                 ulong l = hexToLong&lt;String&gt;(p += 2, e);                                                                                                                 <span class="comment">// &lt;-- hexadecimal literal</span>
<a name="l00492"></a>00492                                                 <span class="keywordflow">if</span> (p == b + 2) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Invalid hexadecimal number&quot;</span>));
<a name="l00493"></a>00493                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, *b == <span class="charliteral">&#39;-&#39;</span> ? -<span class="keywordtype">long</span>(l) : l);
<a name="l00494"></a>00494                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00495"></a>00495                                         } <span class="comment">/* else continue */</span>
<a name="l00496"></a>00496                 
<a name="l00497"></a>00497                 <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;6&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;7&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>: {                                             <span class="comment">// &lt;-- numeric literal</span>
<a name="l00498"></a>00498                                                 <span class="keywordtype">double</span> d = stringToDouble&lt;String&gt;(p, e);
<a name="l00499"></a>00499                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, *b == <span class="charliteral">&#39;-&#39;</span> ? -d : d);
<a name="l00500"></a>00500                                         }
<a name="l00501"></a>00501                                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00502"></a>00502                                         
<a name="l00503"></a>00503                 <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:       <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;alse&quot;</span>))) { <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <span class="keyword">false</span>); <span class="keywordflow">return</span> <span class="keyword">true</span>; }                                      <span class="comment">// &lt;-- false literal</span>
<a name="l00504"></a>00504                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;or&quot;</span>))) {
<a name="l00505"></a>00505                                                 <span class="keywordflow">if</span> (p &gt;= e || *p != <span class="charliteral">&#39;(&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Expected &#39;(&#39;&quot;</span>));                                                                   <span class="comment">// &lt;-- for</span>
<a name="l00506"></a>00506                                                 XValue xv;
<a name="l00507"></a>00507                                                 termExpr(++p, e, xv, <span class="keyword">true</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>, <span class="charliteral">&#39;;&#39;</span>);
<a name="l00508"></a>00508                                                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> cp = p;
<a name="l00509"></a>00509                                                 termExpr(p, e, xv, <span class="keyword">true</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>, <span class="charliteral">&#39;;&#39;</span>);
<a name="l00510"></a>00510                                                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> ip = p;
<a name="l00511"></a>00511                                                 termExpr(p, e, xv, <span class="keyword">true</span>, <span class="keyword">true</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>, <span class="charliteral">&#39;)&#39;</span>);
<a name="l00512"></a>00512                                                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> bp = p;
<a name="l00513"></a>00513                                                 <span class="keywordtype">bool</span> cb = !dry &amp;&amp; rvalue(xv);
<a name="l00514"></a>00514                                                 <span class="keywordflow">do</span> {
<a name="l00515"></a>00515                                                         expr(p = bp, e, v, <span class="keyword">true</span>, !cb, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77acc2c0306507a92ce5939dff809ee3b3d" title="if () x, for () x">BODY</a>);
<a name="l00516"></a>00516                                                         <span class="keywordflow">if</span> (cb) {
<a name="l00517"></a>00517                                                                 <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad2ffdfe9f9a7eb977dca70fa392c9231" title="used only for tracing with tick()">TRACE_LOOP</a>)) tick(p, v, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad2ffdfe9f9a7eb977dca70fa392c9231" title="used only for tracing with tick()">TRACE_LOOP</a>, <span class="keyword">true</span>);
<a name="l00518"></a>00518                                                                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> ep = p;
<a name="l00519"></a>00519                                                                 expr(p = ip, e, xv, <span class="keyword">true</span>, <span class="keyword">false</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>);
<a name="l00520"></a>00520                                                                 expr(p = cp, e, xv, <span class="keyword">true</span>, <span class="keyword">false</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>);
<a name="l00521"></a>00521                                                                 p = ep;
<a name="l00522"></a>00522                                                                 cb = rvalue(xv);
<a name="l00523"></a>00523                                                         }
<a name="l00524"></a>00524                                                 } <span class="keywordflow">while</span> (cb);
<a name="l00525"></a>00525                                                 <span class="keywordflow">if</span> (!dry &amp;&amp; root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad2ffdfe9f9a7eb977dca70fa392c9231" title="used only for tracing with tick()">TRACE_LOOP</a>)) tick(p, v, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad2ffdfe9f9a7eb977dca70fa392c9231" title="used only for tracing with tick()">TRACE_LOOP</a>, <span class="keyword">false</span>);
<a name="l00526"></a>00526                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00527"></a>00527                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;unction&quot;</span>))) {
<a name="l00528"></a>00528                                                 <span class="keywordflow">if</span> (p &gt;= e || *p != <span class="charliteral">&#39;{&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Expected &#39;{&#39;&quot;</span>));
<a name="l00529"></a>00529                                                 b = p;
<a name="l00530"></a>00530                                                 expr(p, e, v, <span class="keyword">false</span>, <span class="keyword">true</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77acc07a34211356447531d1f559137e745" title="function { }">DEFINITION</a>);                                                                                                                 <span class="comment">// &lt;-- function</span>
<a name="l00531"></a>00531                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, p));
<a name="l00532"></a>00532                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00533"></a>00533                                         }
<a name="l00534"></a>00534                                         <span class="keywordflow">break</span>;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536                 <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:       <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; token(p, e, STR(<span class="stringliteral">&quot;f&quot;</span>))) {
<a name="l00537"></a>00537                                                 <span class="keywordflow">if</span> (p &gt;= e || *p != <span class="charliteral">&#39;(&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Expected &#39;(&#39;&quot;</span>));                                                                   <span class="comment">// &lt;-- if</span>
<a name="l00538"></a>00538                                                 XValue c;
<a name="l00539"></a>00539                                                 termExpr(++p, e, c, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>, <span class="charliteral">&#39;)&#39;</span>);
<a name="l00540"></a>00540                                                 <span class="keywordtype">bool</span> b = dry || rvalue(c);
<a name="l00541"></a>00541                                                 expr(p, e, v, <span class="keyword">false</span>, dry || !b, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77acc2c0306507a92ce5939dff809ee3b3d" title="if () x, for () x">BODY</a>);
<a name="l00542"></a>00542                                                 <span class="keywordflow">if</span> (p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;e&#39;</span> &amp;&amp; token(p, e, STR(<span class="stringliteral">&quot;lse&quot;</span>))) expr(p, e, v, <span class="keyword">false</span>, dry || b, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77acc2c0306507a92ce5939dff809ee3b3d" title="if () x, for () x">BODY</a>);                <span class="comment">// &lt;-- else</span>
<a name="l00543"></a>00543                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00544"></a>00544                                         }
<a name="l00545"></a>00545                                         <span class="keywordflow">break</span>;
<a name="l00546"></a>00546         }
<a name="l00547"></a>00547         <span class="keywordflow">while</span> (p &lt; e &amp;&amp; isSymbolChar(*p)) ++p;
<a name="l00548"></a>00548         <span class="keywordflow">if</span> (b != p &amp;&amp; !dry) v = XValue(<span class="keyword">true</span>, <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, p));
<a name="l00549"></a>00549         <span class="keywordflow">return</span> (b != p);
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::post(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres) {
<a name="l00553"></a>00553         assert(p &lt;= e);
<a name="l00554"></a>00554         <span class="keywordflow">switch</span> (p &lt; e ? *p : 0) {
<a name="l00555"></a>00555                 <span class="keywordflow">case</span> 0:         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00556"></a>00556                 <span class="keywordflow">case</span> <span class="charliteral">&#39; &#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\t&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\r&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\n&#39;</span>:
<a name="l00557"></a>00557                                         <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77acc07a34211356447531d1f559137e745" title="function { }">DEFINITION</a>) { <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a> c = *p; <span class="keywordflow">while</span> (++p &lt; e &amp;&amp; *p == c); <span class="keywordflow">return</span> <span class="keyword">true</span>; } <span class="keywordflow">break</span>;                        <span class="comment">// &lt;-- white spaces</span>
<a name="l00558"></a>00558                 <span class="keywordflow">case</span> <span class="charliteral">&#39;/&#39;</span>:       <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77acc07a34211356447531d1f559137e745" title="function { }">DEFINITION</a> &amp;&amp; p + 1 &lt; e &amp;&amp; (p[1] == <span class="charliteral">&#39;/&#39;</span> || p[1] == <span class="charliteral">&#39;*&#39;</span>)) { white(p, e); <span class="keywordflow">return</span> <span class="keyword">true</span>; }      <span class="comment">// &lt;-- comment</span>
<a name="l00559"></a>00559                                         <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a3a7b89ddc31057a8876460de3923e69e" title="x*y x/y x xy">MUL_DIV</a>, std::divides&lt;double&gt;());                                           <span class="comment">// &lt;-- divide</span>
<a name="l00560"></a>00560                 <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>:       <span class="keywordflow">return</span> addSubOp(p, e, v, dry, thres, std::plus&lt;double&gt;());                                                                                      <span class="comment">// &lt;-- add</span>
<a name="l00561"></a>00561                 <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>:       <span class="keywordflow">return</span> addSubOp(p, e, v, dry, thres, std::minus&lt;double&gt;());                                                                                     <span class="comment">// &lt;-- subtract</span>
<a name="l00562"></a>00562                 <span class="keywordflow">case</span> <span class="charliteral">&#39;#&#39;</span>:       <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a65074b2a2d9f6a7094223fa0846ed61f" title="x::y">CONCAT</a>, std::plus&lt;String&gt;());                                                       <span class="comment">// &lt;-- concat</span>
<a name="l00563"></a>00563                 <span class="keywordflow">case</span> <span class="charliteral">&#39;*&#39;</span>:       <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a3a7b89ddc31057a8876460de3923e69e" title="x*y x/y x xy">MUL_DIV</a>, std::multiplies&lt;double&gt;());                                        <span class="comment">// &lt;-- multipy</span>
<a name="l00564"></a>00564                 <span class="keywordflow">case</span> <span class="charliteral">&#39;\\&#39;</span>:      <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a3a7b89ddc31057a8876460de3923e69e" title="x*y x/y x xy">MUL_DIV</a>, std::divides&lt;long&gt;());                                                     <span class="comment">// &lt;-- integer division</span>
<a name="l00565"></a>00565                 <span class="keywordflow">case</span> <span class="charliteral">&#39;%&#39;</span>:       <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a3a7b89ddc31057a8876460de3923e69e" title="x*y x/y x xy">MUL_DIV</a>, std::ptr_fun&lt;double, double&gt;(fmod));                       <span class="comment">// &lt;-- modulus</span>
<a name="l00566"></a>00566                 <span class="keywordflow">case</span> <span class="charliteral">&#39;^&#39;</span>:       <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a1deb00f5c64976ae77db412289ce7b7a" title="x^y">BIT_XOR</a>, bitXor);                                                                           <span class="comment">// &lt;-- xor</span>
<a name="l00567"></a>00567                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&lt;&#39;</span>:       <span class="keywordflow">return</span> lgtOp(p, e, v, dry, thres, std::less&lt;Value&gt;(), std::less_equal&lt;Value&gt;(), shiftLeft);                     <span class="comment">// &lt;-- shift left</span>
<a name="l00568"></a>00568                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&gt;&#39;</span>:       <span class="keywordflow">return</span> lgtOp(p, e, v, dry, thres, std::greater&lt;Value&gt;(), std::greater_equal&lt;Value&gt;(), shiftRight);      <span class="comment">// &lt;-- shift right</span>
<a name="l00569"></a>00569                 
<a name="l00570"></a>00570                 <span class="keywordflow">case</span> <span class="charliteral">&#39;!&#39;</span>:       <span class="keywordflow">if</span> (e - p &gt; 2 &amp;&amp; p[2] == <span class="charliteral">&#39;=&#39;</span> &amp;&amp; p[1] == <span class="charliteral">&#39;=&#39;</span>)
<a name="l00571"></a>00571                                                 <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, 3, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77af1a81c7748d98b7d94141a1776c88bf9" title="x===y x==y x!==y x!=y">EQUALITY</a>, std::not_equal_to&lt;String&gt;());                                 <span class="comment">// &lt;-- literal not equals</span>
<a name="l00572"></a>00572                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;=&#39;</span>)
<a name="l00573"></a>00573                                                 <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, 2, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77af1a81c7748d98b7d94141a1776c88bf9" title="x===y x==y x!==y x!=y">EQUALITY</a>, std::not_equal_to&lt;Value&gt;());                                  <span class="comment">// &lt;-- not equals</span>
<a name="l00574"></a>00574                                         <span class="keywordflow">break</span>;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576                 <span class="keywordflow">case</span> <span class="charliteral">&#39;=&#39;</span>:       <span class="keywordflow">if</span> (e - p &gt; 2 &amp;&amp; p[2] == <span class="charliteral">&#39;=&#39;</span> &amp;&amp; p[1] == <span class="charliteral">&#39;=&#39;</span>)
<a name="l00577"></a>00577                                                 <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, 3, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77af1a81c7748d98b7d94141a1776c88bf9" title="x===y x==y x!==y x!=y">EQUALITY</a>, std::equal_to&lt;String&gt;());                                             <span class="comment">// &lt;-- literal equals</span>
<a name="l00578"></a>00578                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] == <span class="charliteral">&#39;=&#39;</span>)
<a name="l00579"></a>00579                                                 <span class="keywordflow">return</span> binaryOp(p, e, v, dry, thres, 2, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77af1a81c7748d98b7d94141a1776c88bf9" title="x===y x==y x!==y x!=y">EQUALITY</a>, std::equal_to&lt;Value&gt;());                                              <span class="comment">// &lt;-- equals</span>
<a name="l00580"></a>00580                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thres &lt;= <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a61d4ad888ea9cb5bb0237cd8a3b62b45" title="x=y x*=y x/=y x\=y x=y x+=y x-=y x&amp;lt;&amp;lt;=y x&amp;gt;&amp;gt;=y x#=y x&amp;amp;=y x^=y x|=y">ASSIGN</a>) {
<a name="l00581"></a>00581                                                 XValue r;                                                                                                                                                                               <span class="comment">// &lt;-- assign</span>
<a name="l00582"></a>00582                                                 expr(++p, e, r, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a61d4ad888ea9cb5bb0237cd8a3b62b45" title="x=y x*=y x/=y x\=y x=y x+=y x-=y x&amp;lt;&amp;lt;=y x&amp;gt;&amp;gt;=y x#=y x&amp;amp;=y x^=y x|=y">ASSIGN</a>);
<a name="l00583"></a>00583                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, <span class="keyword">set</span>(lvalue(v), rvalue(r)));
<a name="l00584"></a>00584                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00585"></a>00585                                         }
<a name="l00586"></a>00586                                         <span class="keywordflow">break</span>;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&amp;&#39;</span>:       <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] != <span class="charliteral">&#39;&amp;&#39;</span>) <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77aca7a0b94ebd11948ec1db16b9b1ac503" title="x&amp;amp;y">BIT_AND</a>, bitAnd);                     <span class="comment">// &lt;-- bitwise and</span>
<a name="l00589"></a>00589                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ac7aedf9210e210d820a8b02595ef646d" title="x&amp;amp;&amp;amp;y">LOGICAL_AND</a>) {
<a name="l00590"></a>00590                                                 <span class="keywordtype">bool</span> l = !dry &amp;&amp; rvalue(v);                                                                                                                                             <span class="comment">// &lt;-- logical and</span>
<a name="l00591"></a>00591                                                 expr(p += 2, e, v, <span class="keyword">false</span>, !l, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ac7aedf9210e210d820a8b02595ef646d" title="x&amp;amp;&amp;amp;y">LOGICAL_AND</a>);
<a name="l00592"></a>00592                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, l &amp;&amp; rvalue(v));
<a name="l00593"></a>00593                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00594"></a>00594                                         }
<a name="l00595"></a>00595                                         <span class="keywordflow">break</span>;
<a name="l00596"></a>00596                 
<a name="l00597"></a>00597                 <span class="keywordflow">case</span> <span class="charliteral">&#39;|&#39;</span>:       <span class="keywordflow">if</span> (p + 1 &lt; e &amp;&amp; p[1] != <span class="charliteral">&#39;|&#39;</span>) <span class="keywordflow">return</span> assignableOp(p, e, v, dry, thres, 1, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77adb454bcebcf7e0a95c1daaaa630fc45d" title="x|y">BIT_OR</a>, bitOr);                       <span class="comment">// &lt;-- bitwise or</span>
<a name="l00598"></a>00598                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a6d8411ff180d73052963549ed54a0992" title="x||y">LOGICAL_OR</a>) {
<a name="l00599"></a>00599                                                 <span class="keywordtype">bool</span> l = dry || rvalue(v);                                                                                                                                              <span class="comment">// &lt;-- logical or</span>
<a name="l00600"></a>00600                                                 expr(p += 2, e, v, <span class="keyword">false</span>, l, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a6d8411ff180d73052963549ed54a0992" title="x||y">LOGICAL_OR</a>);
<a name="l00601"></a>00601                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">false</span>, l || rvalue(v));
<a name="l00602"></a>00602                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00603"></a>00603                                         }
<a name="l00604"></a>00604                                         <span class="keywordflow">break</span>;
<a name="l00605"></a>00605                 
<a name="l00606"></a>00606                 <span class="keywordflow">case</span> <span class="charliteral">&#39;.&#39;</span>:       {                                                                                                                                                                                                       <span class="comment">// &lt;-- member</span>
<a name="l00607"></a>00607                                                 <span class="keywordflow">if</span> (++p &lt; e &amp;&amp; maybeWhite(*p)) white(p, e);
<a name="l00608"></a>00608                                                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> b = p;
<a name="l00609"></a>00609                                                 <span class="keywordflow">while</span> (p &lt; e &amp;&amp; isSymbolChar(*p)) ++p;
<a name="l00610"></a>00610                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">true</span>, lvalue(v)[<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(b, p)]);
<a name="l00611"></a>00611                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00612"></a>00612                                         }
<a name="l00613"></a>00613                                         
<a name="l00614"></a>00614                 <span class="keywordflow">case</span> <span class="charliteral">&#39;[&#39;</span>:       <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a719f62687a31133a1acf74172e5cb5b7" title="x() x.y x[y] x{y} x++ x--">POSTFIX</a>) {                                                                                                                                                          <span class="comment">// &lt;-- subscript</span>
<a name="l00615"></a>00615                                                 XValue element;
<a name="l00616"></a>00616                                                 termExpr(++p, e, element, <span class="keyword">false</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab4c72877103485cfeef038e0dbe8cfb3" title="(x) [x]">BRACKETS</a>, <span class="charliteral">&#39;]&#39;</span>);
<a name="l00617"></a>00617                                                 <span class="keywordflow">if</span> (!dry) v = XValue(<span class="keyword">true</span>, lvalue(v)[rvalue(element)]);
<a name="l00618"></a>00618                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00619"></a>00619                                         }
<a name="l00620"></a>00620                                         <span class="keywordflow">break</span>;
<a name="l00621"></a>00621                                         
<a name="l00622"></a>00622                 <span class="keywordflow">case</span> <span class="charliteral">&#39;{&#39;</span>:       <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a719f62687a31133a1acf74172e5cb5b7" title="x() x.y x[y] x{y} x++ x--">POSTFIX</a>) {                                                                                                                                                          <span class="comment">// &lt;-- substring</span>
<a name="l00623"></a>00623                                                 XValue index;
<a name="l00624"></a>00624                                                 <span class="keywordtype">bool</span> gotIndex = expr(++p, e, index, <span class="keyword">true</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab4c72877103485cfeef038e0dbe8cfb3" title="(x) [x]">BRACKETS</a>);
<a name="l00625"></a>00625                                                 <span class="keywordflow">if</span> (p &gt;= e || (*p != <span class="charliteral">&#39;:&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;}&#39;</span>)) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Expected &#39;}&#39; or &#39;:&#39;&quot;</span>));
<a name="l00626"></a>00626                                                 <span class="keywordflow">if</span> (*p++ == <span class="charliteral">&#39;:&#39;</span>) {
<a name="l00627"></a>00627                                                         XValue count;
<a name="l00628"></a>00628                                                         <span class="keywordtype">bool</span> gotCount = termExpr(p, e, count, <span class="keyword">true</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ab4c72877103485cfeef038e0dbe8cfb3" title="(x) [x]">BRACKETS</a>, <span class="charliteral">&#39;}&#39;</span>);
<a name="l00629"></a>00629                                                         <span class="keywordflow">if</span> (!dry) {
<a name="l00630"></a>00630                                                                 <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> s = rvalue(v);
<a name="l00631"></a>00631                                                                 <span class="keywordtype">long</span> i = !gotIndex ? 0L : long(rvalue(index));
<a name="l00632"></a>00632                                                                 <span class="keywordtype">long</span> n = gotCount ? long(rvalue(count)) + mini(i, 0L) : <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>::npos;
<a name="l00633"></a>00633                                                                 v = XValue(<span class="keyword">false</span>, i &lt;= <span class="keywordtype">long</span>(s.size()) &amp;&amp; (!gotCount || n &gt;= 0L)
<a name="l00634"></a>00634                                                                                 ? <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>(s.substr(maxi(i, 0L), n)) : <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>());
<a name="l00635"></a>00635                                                         }
<a name="l00636"></a>00636                                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gotIndex &amp;&amp; !dry) {
<a name="l00637"></a>00637                                                         <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> s = rvalue(v);
<a name="l00638"></a>00638                                                         <span class="keywordtype">long</span> i = long(rvalue(index));
<a name="l00639"></a>00639                                                         v = XValue(<span class="keyword">false</span>, i &gt;= 0L &amp;&amp; i &lt;= <span class="keywordtype">long</span>(s.size()) ? <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>(s.substr(i, 1)) : <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>());
<a name="l00640"></a>00640                                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!dry) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Syntax error&quot;</span>));
<a name="l00641"></a>00641                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00642"></a>00642                                         }
<a name="l00643"></a>00643                                         <span class="keywordflow">break</span>;
<a name="l00644"></a>00644 
<a name="l00645"></a>00645                 <span class="keywordflow">case</span> <span class="charliteral">&#39;(&#39;</span>:       <span class="keywordflow">if</span> (thres &lt; <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a719f62687a31133a1acf74172e5cb5b7" title="x() x.y x[y] x{y} x++ x--">POSTFIX</a>) {                                                                                                                                                          <span class="comment">// &lt;-- call</span>
<a name="l00646"></a>00646                                                 <span class="keyword">typename</span> CFG::Locals locals;
<a name="l00647"></a>00647                                                 Frame calleeFrame(locals, root, <span class="keyword">this</span>);
<a name="l00648"></a>00648                                                 <span class="keywordtype">long</span> n = 0;
<a name="l00649"></a>00649                                                 <span class="keywordflow">do</span> {
<a name="l00650"></a>00650                                                         <span class="keywordflow">if</span> (++p &lt; e &amp;&amp; maybeWhite(*p)) white(p, e);
<a name="l00651"></a>00651                                                         <span class="keywordflow">if</span> (p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;)&#39;</span> &amp;&amp; n == 0) <span class="keywordflow">break</span>;
<a name="l00652"></a>00652                                                         XValue arg;
<a name="l00653"></a>00653                                                         <span class="keywordflow">if</span> (expr(p, e, arg, <span class="keyword">true</span>, dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ad26cff976a7c2fb357710b57402af680" title="(x, y)">ARGUMENT</a>) &amp;&amp; !dry)
<a name="l00654"></a>00654                                                                 locals.assign(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;$&quot;</span>)) += intToString&lt;String&gt;(n), rvalue(arg));
<a name="l00655"></a>00655                                                         ++n;
<a name="l00656"></a>00656                                                 } <span class="keywordflow">while</span> (p &lt; e &amp;&amp; *p == <span class="charliteral">&#39;,&#39;</span>);
<a name="l00657"></a>00657                                                 <span class="keywordflow">if</span> (p &gt;= e || *p != <span class="charliteral">&#39;)&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Expected &#39;,&#39; or &#39;)&#39;&quot;</span>));
<a name="l00658"></a>00658                                                 ++p;
<a name="l00659"></a>00659                                                 <span class="keywordflow">if</span> (!dry) {
<a name="l00660"></a>00660                                                         locals.assign(STR(<span class="stringliteral">&quot;$n&quot;</span>), n);
<a name="l00661"></a>00661                                                         <span class="keywordflow">if</span> (v.first) locals.assign(STR(<span class="stringliteral">&quot;$callee&quot;</span>), v.second);
<a name="l00662"></a>00662                                                         v = XValue(<span class="keyword">false</span>, calleeFrame.execute(rvalue(v)));
<a name="l00663"></a>00663                                                 }
<a name="l00664"></a>00664                                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00665"></a>00665                                         }
<a name="l00666"></a>00666                                         <span class="keywordflow">break</span>;
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::Frame::tick(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> XValue&amp; v, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres, <span class="keywordtype">bool</span> exit) {
<a name="l00672"></a>00672         root.trace(*<span class="keyword">this</span>, *source, p - source-&gt;begin(), v.first, v.second, thres, exit);
<a name="l00673"></a>00673 }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::expr(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> emptyOk, <span class="keywordtype">bool</span> dry, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres) {
<a name="l00676"></a>00676         assert(p &lt;= e);
<a name="l00677"></a>00677         <span class="keywordflow">if</span> (p &lt; e &amp;&amp; maybeWhite(*p)) white(p, e);
<a name="l00678"></a>00678         <span class="keywordflow">if</span> (!dry &amp;&amp; root.doTrace(thres)) tick(p, v, thres, <span class="keyword">false</span>);
<a name="l00679"></a>00679         <span class="keywordflow">if</span> (pre(p, e, v, dry)) {
<a name="l00680"></a>00680                 <span class="keywordflow">while</span> (post(p, e, v, dry, thres));
<a name="l00681"></a>00681                 <span class="keywordflow">if</span> (!dry &amp;&amp; root.doTrace(thres)) tick(p, v, thres, <span class="keyword">true</span>);
<a name="l00682"></a>00682                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00683"></a>00683         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!emptyOk) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Syntax error&quot;</span>));
<a name="l00684"></a>00684         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::Frame::termExpr(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; p, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; e, XValue&amp; v, <span class="keywordtype">bool</span> emptyOk, <span class="keywordtype">bool</span> dry
<a name="l00688"></a>00688                 , <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> thres, <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a> term) {
<a name="l00689"></a>00689         assert(p &lt;= e);
<a name="l00690"></a>00690         <span class="keywordtype">bool</span> nonEmpty = expr(p, e, v, emptyOk, dry, thres);
<a name="l00691"></a>00691         <span class="keywordflow">if</span> (p &gt;= e || *p != term) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>((<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Missing &#39;&quot;</span>)) += <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(&amp;term, 1)) += <span class="charliteral">&#39;\&#39;&#39;</span>);
<a name="l00692"></a>00692         ++p;
<a name="l00693"></a>00693         <span class="keywordflow">return</span> nonEmpty;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::Frame::evaluate(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> source) {
<a name="l00697"></a>00697         XValue v;
<a name="l00698"></a>00698         <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>* oldSource = this-&gt;source;
<a name="l00699"></a>00699         this-&gt;source = &amp;source;
<a name="l00700"></a>00700         <span class="keywordflow">try</span> {
<a name="l00701"></a>00701                 <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> p = source.begin(), e = source.end();
<a name="l00702"></a>00702                 <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>)) tick(p, v, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>, <span class="keyword">false</span>);
<a name="l00703"></a>00703                 <span class="keywordflow">try</span> {
<a name="l00704"></a>00704                         <span class="keywordflow">try</span> {
<a name="l00705"></a>00705                                 <span class="keywordflow">while</span> (p &lt; e) {
<a name="l00706"></a>00706                                         expr(p, e, v, <span class="keyword">true</span>, <span class="keyword">false</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ac3d6d16da3d35c2ce90122057f3a0581" title="x; y;">STATEMENT</a>);
<a name="l00707"></a>00707                                         <span class="keywordflow">if</span> (p &lt; e) {
<a name="l00708"></a>00708                                                 <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;;&#39;</span>) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Syntax error&quot;</span>));
<a name="l00709"></a>00709                                                 ++p;
<a name="l00710"></a>00710                                         }
<a name="l00711"></a>00711                                 }
<a name="l00712"></a>00712                                 v = XValue(<span class="keyword">false</span>, rvalue(v));
<a name="l00713"></a>00713                         } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>&amp; x) {
<a name="l00714"></a>00714                                 <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a011f8548cb6d2cdc043a4f4abe3e78e2" title="used only for tracing with tick()">TRACE_ERROR</a>)) tick(p, XValue(<span class="keyword">false</span>, x.getError()), <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a011f8548cb6d2cdc043a4f4abe3e78e2" title="used only for tracing with tick()">TRACE_ERROR</a>, previous == 0);
<a name="l00715"></a>00715                                 <span class="keywordflow">throw</span>;
<a name="l00716"></a>00716                         } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; x) {
<a name="l00717"></a>00717                                 <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a011f8548cb6d2cdc043a4f4abe3e78e2" title="used only for tracing with tick()">TRACE_ERROR</a>)) {
<a name="l00718"></a>00718                                         <span class="keyword">const</span> <span class="keywordtype">char</span>* s = x.what();
<a name="l00719"></a>00719                                         <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> err = <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(std::basic_string&lt;Char&gt;(s, s + strlen(s)));
<a name="l00720"></a>00720                                         tick(p, XValue(<span class="keyword">false</span>, err), <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a011f8548cb6d2cdc043a4f4abe3e78e2" title="used only for tracing with tick()">TRACE_ERROR</a>, previous == 0);
<a name="l00721"></a>00721                                 }
<a name="l00722"></a>00722                                 <span class="keywordflow">throw</span>;
<a name="l00723"></a>00723                         } <span class="keywordflow">catch</span> (...) {
<a name="l00724"></a>00724                                 <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a011f8548cb6d2cdc043a4f4abe3e78e2" title="used only for tracing with tick()">TRACE_ERROR</a>))
<a name="l00725"></a>00725                                         tick(p, XValue(<span class="keyword">false</span>, STR(<span class="stringliteral">&quot;Unknown exception&quot;</span>)), <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a011f8548cb6d2cdc043a4f4abe3e78e2" title="used only for tracing with tick()">TRACE_ERROR</a>, previous == 0);
<a name="l00726"></a>00726                                 <span class="keywordflow">throw</span>;
<a name="l00727"></a>00727                         }
<a name="l00728"></a>00728                 } <span class="keywordflow">catch</span> (...) {
<a name="l00729"></a>00729                         <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>)) tick(p, v, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>, <span class="keyword">true</span>);
<a name="l00730"></a>00730                         <span class="keywordflow">throw</span>;
<a name="l00731"></a>00731                 }
<a name="l00732"></a>00732                 <span class="keywordflow">if</span> (root.doTrace(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>)) tick(p, v, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>, <span class="keyword">true</span>);
<a name="l00733"></a>00733         } <span class="keywordflow">catch</span> (...) {
<a name="l00734"></a>00734                 this-&gt;source = oldSource;
<a name="l00735"></a>00735                 <span class="keywordflow">throw</span>;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737         this-&gt;source = oldSource;
<a name="l00738"></a>00738         <span class="keywordflow">return</span> v.second;
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>) Script&lt;CFG&gt;::Frame::parse(const <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; begin, const <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a>&amp; end, <span class="keywordtype">bool</span> literal) {
<a name="l00742"></a>00742         assert(begin &lt;= end);
<a name="l00743"></a>00743         <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> p = begin, e = end;
<a name="l00744"></a>00744         XValue dummy;
<a name="l00745"></a>00745         <span class="keywordflow">if</span> (!literal) expr(p, end, dummy, <span class="keyword">true</span>, <span class="keyword">true</span>, <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77ac3d6d16da3d35c2ce90122057f3a0581" title="x; y;">STATEMENT</a>);
<a name="l00746"></a>00746         <span class="keywordflow">else</span> <span class="keywordflow">switch</span> (p &lt; e ? *p : 0) {
<a name="l00747"></a>00747                 <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>: <span class="keywordflow">if</span> (!token(p, e, STR(<span class="stringliteral">&quot;alse&quot;</span>)) &amp;&amp; token(p, e, STR(<span class="stringliteral">&quot;unction&quot;</span>))) pre(p = begin, e, dummy, <span class="keyword">true</span>); <span class="keywordflow">break</span>;
<a name="l00748"></a>00748                 <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>: token(p, e, STR(<span class="stringliteral">&quot;rue&quot;</span>)); <span class="keywordflow">break</span>;
<a name="l00749"></a>00749                 <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>: token(p, e, STR(<span class="stringliteral">&quot;oid&quot;</span>)); <span class="keywordflow">break</span>;
<a name="l00750"></a>00750                 <span class="keywordflow">case</span> <span class="charliteral">&#39;+&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;-&#39;</span>: <span class="keywordflow">if</span> (token(p, e, STR(<span class="stringliteral">&quot;infinity&quot;</span>)) || p + 1 &gt;= e || p[1] &lt; <span class="charliteral">&#39;0&#39;</span> || p[1] &gt; <span class="charliteral">&#39;9&#39;</span>) <span class="keywordflow">break</span>;
<a name="l00751"></a>00751                 <span class="keywordflow">case</span> <span class="charliteral">&#39;&lt;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;&gt;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;\&#39;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;&quot;&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;6&#39;</span>:
<a name="l00752"></a>00752                 <span class="keywordflow">case</span> <span class="charliteral">&#39;7&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>: <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>: pre(p, e, dummy, <span class="keyword">true</span>); <span class="keywordflow">break</span>;            
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754         <span class="keywordflow">return</span> p;
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::Frame::call(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; callee, const <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>&amp; body, <span class="keywordtype">long</span> argc, const <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>* argv) {
<a name="l00758"></a>00758         assert(argc &gt;= 0);
<a name="l00759"></a>00759         <span class="keyword">typename</span> CFG::Locals locals;
<a name="l00760"></a>00760         Frame calleeFrame(locals, root, <span class="keyword">this</span>);
<a name="l00761"></a>00761         locals.assign(STR(<span class="stringliteral">&quot;$n&quot;</span>), argc);
<a name="l00762"></a>00762         <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; argc; ++i) locals.assign(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;$&quot;</span>)) += intToString&lt;String&gt;(i), argv[i]);
<a name="l00763"></a>00763         <span class="keywordflow">if</span> (!callee.empty()) locals.assign(STR(<span class="stringliteral">&quot;$callee&quot;</span>), callee);
<a name="l00764"></a>00764         <span class="keywordflow">return</span> calleeFrame.execute(body.empty() ? <span class="keyword">get</span>(callee, <span class="keyword">true</span>) : body);
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00767"></a><a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d">00767</a> TMPL <span class="keywordtype">void</span> <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Frame::registerNative</a>(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier, <a class="code" href="class_pika_1_1_script_1_1_native.html" title="Native is the base class for the native functions and objects that can be accessed from PikaScript...">Native</a>* native) {
<a name="l00768"></a>00768         std::pair&lt;Frame*, String&gt; p = resolveFrame(identifier);
<a name="l00769"></a>00769         <span class="keywordflow">if</span> (!p.first-&gt;vars.assignNative(p.second, native))
<a name="l00770"></a>00770                 <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Cannot register native: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(identifier));
<a name="l00771"></a>00771         <span class="keywordflow">if</span> (native != 0)
<a name="l00772"></a>00772                 p.first-&gt;set(p.second, (<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;&lt;&quot;</span>)) += (p.first == &amp;root ? p.second : p.first-&gt;label + p.second)) += <span class="charliteral">&#39;&gt;&#39;</span>);
<a name="l00773"></a>00773 }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 <span class="comment">/* --- Root --- */</span>
<a name="l00776"></a>00776 
<a name="l00777"></a>00777 TMPL <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Root::Root</a>(<a class="code" href="class_pika_1_1_script_1_1_variables.html" title="Variables is an abstract base class which implements the interface to the variable space that a Frame...">Variables</a>&amp; vars) : <a class="code" href="class_pika_1_1_script_1_1_frame.html" title="The execution context and interpreter for PikaScript.">Frame</a>(vars, *this, 0), traceLevel(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a3e307bcf17899d6e44f9e8506ef3fc6d" title="used only for tracing with tick()">NO_TRACE</a>), isInsideTracer(false)
<a name="l00778"></a>00778                 , autoLabelStart(autoLabel + 29) {
<a name="l00779"></a>00779         std::fill_n(autoLabel, 32, <span class="charliteral">&#39;:&#39;</span>);
<a name="l00780"></a>00780 }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script</a>&lt;CFG&gt;::Root::generateLabel() {
<a name="l00783"></a>00783         <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a>* b = autoLabelStart, * p = autoLabel + 30;
<a name="l00784"></a>00784         <span class="keywordflow">while</span> (*--p == <span class="charliteral">&#39;z&#39;</span>);
<a name="l00785"></a>00785         <span class="keywordflow">switch</span> (*p) {
<a name="l00786"></a>00786                 <span class="keywordflow">case</span> <span class="charliteral">&#39;:&#39;</span>:       *p = <span class="charliteral">&#39;1&#39;</span>; *--b = <span class="charliteral">&#39;:&#39;</span>; autoLabelStart = b; <span class="keywordflow">break</span>;
<a name="l00787"></a>00787                 <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>:       *p = <span class="charliteral">&#39;A&#39;</span>; <span class="keywordflow">break</span>;
<a name="l00788"></a>00788                 <span class="keywordflow">case</span> <span class="charliteral">&#39;Z&#39;</span>:       *p = <span class="charliteral">&#39;a&#39;</span>; <span class="keywordflow">break</span>;
<a name="l00789"></a>00789                 <span class="keywordflow">default</span>:        (*p)++; <span class="keywordflow">break</span>;
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791         <span class="keywordflow">for</span> (++p; *p != <span class="charliteral">&#39;:&#39;</span>; ++p) *p = <span class="charliteral">&#39;0&#39;</span>;
<a name="l00792"></a>00792         <span class="keywordflow">return</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(const_cast&lt;const Char*&gt;(b), autoLabel + 31 - b);
<a name="l00793"></a>00793 }
<a name="l00794"></a>00794 
<a name="l00795"></a><a class="code" href="class_pika_1_1_script_1_1_root.html#aad291187d970d4f2e2cef07c05d47f67">00795</a> TMPL <span class="keywordtype">void</span> <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Root::setTracer</a>(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> traceLevel, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>&amp; tracerFunction) <span class="keywordflow">throw</span>() {
<a name="l00796"></a>00796         this-&gt;traceLevel = traceLevel;
<a name="l00797"></a>00797         this-&gt;tracerFunction = tracerFunction;
<a name="l00798"></a>00798 }
<a name="l00799"></a>00799 
<a name="l00800"></a><a class="code" href="class_pika_1_1_script_1_1_root.html#a24d3945dae3559905e6f0f75b7e21730">00800</a> TMPL <span class="keywordtype">void</span> <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Root::trace</a>(<a class="code" href="class_pika_1_1_script_1_1_frame.html" title="The execution context and interpreter for PikaScript.">Frame</a>&amp; frame, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; source, <a class="code" href="struct_pika_1_1_script.html#a98629831dc5c236cd2e90ba2e3ceedcf" title="The length type for all strings (defined by the string class). E.g. size_t.">SizeType</a> offset, <span class="keywordtype">bool</span> lvalue, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>&amp; value
<a name="l00801"></a>00801                 , <a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a> level, <span class="keywordtype">bool</span> exit) {
<a name="l00802"></a>00802         <span class="keywordflow">if</span> (!tracerFunction.isVoid() &amp;&amp; !isInsideTracer) {
<a name="l00803"></a>00803                 <span class="keywordflow">try</span> {
<a name="l00804"></a>00804                         isInsideTracer = <span class="keyword">true</span>;
<a name="l00805"></a>00805                         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> argv[6] = { source, <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(offset), lvalue, value, <span class="keywordtype">int</span>(level), exit };
<a name="l00806"></a>00806                         frame.<a class="code" href="class_pika_1_1_script_1_1_frame.html#afa442408ef85bc91819df70faf4df4be" title="Calls a Pika function (by setting up a new &amp;quot;sub-frame&amp;quot; and executing the function body)...">call</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(), tracerFunction, 6, argv);
<a name="l00807"></a>00807                         isInsideTracer = <span class="keyword">false</span>;
<a name="l00808"></a>00808                 } <span class="keywordflow">catch</span> (...) {
<a name="l00809"></a>00809                         isInsideTracer = <span class="keyword">false</span>;
<a name="l00810"></a>00810                         setTracer(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a3e307bcf17899d6e44f9e8506ef3fc6d" title="used only for tracing with tick()">NO_TRACE</a>, <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>());                                                                                                                                                           <span class="comment">// Turn off tracing on uncaught exceptions.</span>
<a name="l00811"></a>00811                         <span class="keywordflow">throw</span>;
<a name="l00812"></a>00812                 }
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 <span class="comment">/* --- STLVariables --- */</span>
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 TMPL <span class="keywordtype">bool</span> <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::STLVariables::lookup</a>(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; symbol, <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>&amp; result) {
<a name="l00819"></a>00819         <span class="keyword">typename</span> VariableMap::const_iterator it = vars.find(symbol);
<a name="l00820"></a>00820         <span class="keywordflow">if</span> (it == vars.end()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00821"></a>00821         result = it-&gt;second;
<a name="l00822"></a>00822         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825 TMPL <span class="keywordtype">void</span> <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::STLVariables::list</a>(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; key, <span class="keyword">typename</span> Variables::VarList&amp; list) {
<a name="l00826"></a>00826         <span class="keywordflow">for</span> (<span class="keyword">typename</span> VariableMap::const_iterator it = vars.lower_bound(key)
<a name="l00827"></a>00827                         ; it != vars.end() &amp;&amp; it-&gt;first.substr(0, key.size()) == key; ++it) list.push_back(*it);
<a name="l00828"></a>00828 }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830 TMPL T_TYPE(Native*) Script&lt;CFG&gt;::STLVariables::lookupNative(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier) {
<a name="l00831"></a>00831         <span class="keyword">typename</span> NativeMap::iterator it = natives.find(identifier);
<a name="l00832"></a>00832         <span class="keywordflow">return</span> (it == natives.end() ? 0 : it-&gt;second);
<a name="l00833"></a>00833 }
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::STLVariables::assignNative(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; identifier, Native* native) {
<a name="l00836"></a>00836         <span class="keyword">typename</span> NativeMap::iterator it = natives.insert(<span class="keyword">typename</span> NativeMap::value_type(identifier, (Native*)(0))).first;
<a name="l00837"></a>00837         <span class="keywordflow">if</span> (it-&gt;second != native) <span class="keyword">delete</span> it-&gt;second;
<a name="l00838"></a>00838         it-&gt;second = native;
<a name="l00839"></a>00839         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00840"></a>00840 }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 TMPL Script&lt;CFG&gt;::STLVariables::~STLVariables() {
<a name="l00843"></a>00843         <span class="keywordflow">for</span> (<span class="keyword">typename</span> NativeMap::iterator it = natives.begin(); it != natives.end(); ++it) <span class="keyword">delete</span> it-&gt;second;
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="comment">/* --- Standard Library --- */</span>
<a name="l00847"></a>00847 
<a name="l00848"></a>00848 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::<a class="code" href="struct_pika_1_1_script.html#ab83ca3cf9abeb9d9a80b6f41a619bd6d" title="Used to &amp;quot;aggregate&amp;quot; different method calls into a single function call.">elevate</a>(Frame&amp; f) { <span class="keywordflow">return</span> f.execute(f.get(<a class="code" href="struct_pika_1_1_script.html#ad6128df8ad57561ecb6c3dd4f8d5ee34" title="getThisAndMethod splits the $callee variable of frame into object (&amp;quot;this&amp;quot;) and method...">getThisAndMethod</a>(f).first, <span class="keyword">true</span>)); }
<a name="l00849"></a>00849 TMPL ulong Script&lt;CFG&gt;::length(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; s) { <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(s.size()); }
<a name="l00850"></a>00850 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::lower(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> s) { std::transform(s.begin(), s.end(), s.begin(), ::tolower); <span class="keywordflow">return</span> s; }
<a name="l00851"></a>00851 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::print(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; s) { xcout&lt;Char&gt;() &lt;&lt; std::basic_string&lt;Char&gt;(s) &lt;&lt; std::endl; }
<a name="l00852"></a>00852 TMPL <span class="keywordtype">double</span> Script&lt;CFG&gt;::random(<span class="keywordtype">double</span> m) { <span class="keywordflow">return</span> m * ::rand() / <span class="keywordtype">double</span>(RAND_MAX); }
<a name="l00853"></a>00853 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::reverse(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> s) { std::reverse(s.begin(), s.end()); <span class="keywordflow">return</span> s; }
<a name="l00854"></a>00854 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::thrower(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; s) { <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(s); }
<a name="l00855"></a>00855 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::time(const Frame&amp;) { <span class="keywordflow">return</span> double(::time(0)); }
<a name="l00856"></a>00856 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::upper(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> s) { std::transform(s.begin(), s.end(), s.begin(), ::toupper); <span class="keywordflow">return</span> s; }
<a name="l00857"></a>00857 
<a name="l00858"></a><a class="code" href="struct_pika_1_1_script.html#ad6128df8ad57561ecb6c3dd4f8d5ee34">00858</a> TMPL std::pair&lt;T_TYPE(Value), T_TYPE(String)&gt; <a class="code" href="struct_pika_1_1_script.html#ad6128df8ad57561ecb6c3dd4f8d5ee34" title="getThisAndMethod splits the $callee variable of frame into object (&amp;quot;this&amp;quot;) and method...">Script&lt;CFG&gt;::getThisAndMethod</a>(Frame&amp; f) {
<a name="l00859"></a>00859         <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> fn = f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ac2e043edd0e0aafcc49ceb97958c4ee7" title="Gets a variable value.">get</a>(STR(<span class="stringliteral">&quot;$callee&quot;</span>));
<a name="l00860"></a>00860         <a class="code" href="struct_pika_1_1_script.html#a51d04c764c99771aa23ce7a863b376a3" title="The const_iterator of the string is used so frequently it deserves its own typedef.">StringIt</a> it = std::find(fn.rbegin(), fn.rend(), <span class="charliteral">&#39;.&#39;</span>).base();
<a name="l00861"></a>00861         <span class="keywordflow">if</span> (it &lt;= fn.begin()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Non-method call&quot;</span>));
<a name="l00862"></a>00862         <span class="keywordflow">return</span> std::pair&lt;Value, String&gt;(f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ac56c22eb25a6473caae4117422d39b8e" title="Returns a reference to the previous frame (i.e. the frame of the caller of this frame). Must not be called on the root frame (will assert).">getPrevious</a>().<a class="code" href="class_pika_1_1_script_1_1_frame.html#a9328ce1c3b2e2e233a9dbe95e6383d26" title="Creates a reference to the variable identified by identifier by prefixing it with a &amp;quot;frame label...">reference</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(fn.begin(), it - 1)), <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(it, fn.end()));
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script</a>&lt;CFG&gt;::character(<span class="keywordtype">double</span> d) {
<a name="l00866"></a>00866         <span class="keywordflow">if</span> (uintChar(<a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a>(d)) != d) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Illegal character code: &quot;</span>)) += doubleToString&lt;String&gt;(d));
<a name="l00867"></a>00867         <span class="keywordflow">return</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(1, <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a>(d));
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 TMPL uint Script&lt;CFG&gt;::ordinal(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; s) {
<a name="l00871"></a>00871         <span class="keywordflow">if</span> (s.size() != 1) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Value is not single character: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(s));
<a name="l00872"></a>00872         <span class="keywordflow">return</span> uintChar(s[0]);
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::deleter(<span class="keyword">const</span> Frame&amp; f) {
<a name="l00876"></a>00876         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> x = f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>));
<a name="l00877"></a>00877         std::pair&lt;Frame*, String&gt; fs = f.getPrevious().resolveFrame(x);
<a name="l00878"></a>00878         <span class="keywordflow">return</span> fs.first-&gt;getVariables().erase(fs.second);
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::evaluate(const Frame&amp; f) {
<a name="l00882"></a>00882         <span class="keywordflow">return</span> f.resolveFrame(f.getOptional(STR(<span class="stringliteral">&quot;$1&quot;</span>))).first-&gt;evaluate(f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>)));
<a name="l00883"></a>00883 }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885 TMPL <span class="keywordtype">bool</span> Script&lt;CFG&gt;::exists(<span class="keyword">const</span> Frame&amp; f) {
<a name="l00886"></a>00886         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> x = f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>));
<a name="l00887"></a>00887         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> result;
<a name="l00888"></a>00888         std::pair&lt;Frame*, String&gt; fs = f.getPrevious().resolveFrame(x);
<a name="l00889"></a>00889         <span class="keywordflow">return</span> fs.first-&gt;getVariables().lookup(fs.second, result);
<a name="l00890"></a>00890 }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 TMPL ulong Script&lt;CFG&gt;::find(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; a, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; b) {
<a name="l00893"></a>00893         <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(std::find_first_of(a.begin(), a.end(), b.begin(), b.end()) - a.begin());
<a name="l00894"></a>00894 }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::foreach(Frame&amp; f) {
<a name="l00897"></a>00897         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> arg1 = f.get(STR(<span class="stringliteral">&quot;$1&quot;</span>));
<a name="l00898"></a>00898         std::pair&lt;Frame*, String&gt; fs = f.getPrevious().resolveFrame(f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>))[<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>()]); 
<a name="l00899"></a>00899         <span class="keyword">typename</span> Variables::VarList list;
<a name="l00900"></a>00900         fs.first-&gt;getVariables().list(fs.second, list);
<a name="l00901"></a>00901         <span class="keywordflow">for</span> (<span class="keyword">typename</span> Variables::VarList::const_iterator it = list.begin(); it != list.end(); ++it) {
<a name="l00902"></a>00902                 <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> argv[3] = { fs.first-&gt;reference(it-&gt;first), it-&gt;first.substr(fs.second.size()), it-&gt;second };
<a name="l00903"></a>00903                 f.call(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(), arg1, 3, argv);
<a name="l00904"></a>00904         }
<a name="l00905"></a>00905 }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::input(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; prompt) {
<a name="l00908"></a>00908         xcout&lt;Char&gt;() &lt;&lt; std::basic_string&lt;Char&gt;(prompt);
<a name="l00909"></a>00909         std::basic_string&lt;Char&gt; s;
<a name="l00910"></a>00910         std::basic_istream&lt;Char&gt;&amp; instream = xcin&lt;Char&gt;();
<a name="l00911"></a>00911         <span class="keywordflow">if</span> (instream.bad()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Input file error&quot;</span>));
<a name="l00912"></a>00912         <span class="keywordflow">if</span> (instream.eof()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(STR(<span class="stringliteral">&quot;Unexpected end of input file&quot;</span>));
<a name="l00913"></a>00913         getline(instream, s);
<a name="l00914"></a>00914         <span class="keywordflow">return</span> s;
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::invoke(Frame&amp; f) {
<a name="l00918"></a>00918         <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a> source = f.get(STR(<span class="stringliteral">&quot;$2&quot;</span>)), arg4 = f.getOptional(STR(<span class="stringliteral">&quot;$4&quot;</span>));
<a name="l00919"></a>00919         <span class="keywordtype">long</span> offset = long(f.getOptional(STR(<span class="stringliteral">&quot;$3&quot;</span>), 0));
<a name="l00920"></a>00920         std::vector&lt;Value&gt; a(arg4.isVoid() ? long(f.get(source[<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;n&quot;</span>))])) - offset : <span class="keywordtype">long</span>(arg4));
<a name="l00921"></a>00921         <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; long(a.size()); ++i) a[i] = f.get(source[i + offset]);
<a name="l00922"></a>00922         <span class="keywordflow">return</span> f.call(f.getOptional(STR(<span class="stringliteral">&quot;$0&quot;</span>)), f.getOptional(STR(<span class="stringliteral">&quot;$1&quot;</span>)), long(a.size()), a.empty() ? 0 : &amp;a[0]);
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::load(const <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; file) {
<a name="l00926"></a>00926         std::basic_ifstream&lt;Char&gt; instream(toStdString(file).c_str());                                                                                                          <span class="comment">// Sorry, can&#39;t pass a wchar_t filename. MSVC supports it, but it is non-standard. So we convert to a std::string to be on the safe side.</span>
<a name="l00927"></a>00927         <span class="keywordflow">if</span> (!instream.good()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Cannot open file for reading: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(file));
<a name="l00928"></a>00928         <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> chars;
<a name="l00929"></a>00929         <span class="keywordflow">while</span> (!instream.eof()) {
<a name="l00930"></a>00930                 <span class="keywordflow">if</span> (instream.bad()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Error reading from file: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(file));
<a name="l00931"></a>00931                 <a class="code" href="struct_pika_1_1_script.html#aef6897fab5d45f685c22acf813e75e32" title="The character type for all strings (defined by the string class). E.g. char.">Char</a> buffer[1024];
<a name="l00932"></a>00932                 instream.read(buffer, 1024);
<a name="l00933"></a>00933                 chars += <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(buffer, static_cast&lt;typename String::size_type&gt;(instream.gcount()));
<a name="l00934"></a>00934         }
<a name="l00935"></a>00935         <span class="keywordflow">return</span> chars;
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 TMPL ulong Script&lt;CFG&gt;::mismatch(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; a, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; b) {
<a name="l00939"></a>00939         <span class="keywordflow">if</span> (a.size() &gt; b.size()) <span class="keywordflow">return</span> static_cast&lt;ulong&gt;(std::mismatch(b.begin(), b.end(), a.begin()).first - b.begin());
<a name="l00940"></a>00940         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(std::mismatch(a.begin(), a.end(), b.begin()).first - a.begin());
<a name="l00941"></a>00941 }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943 TMPL ulong Script&lt;CFG&gt;::parse(Frame&amp; f) {
<a name="l00944"></a>00944         <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> source = f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>));
<a name="l00945"></a>00945         <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(f.parse(source.begin(), source.end(), f.get(STR(<span class="stringliteral">&quot;$1&quot;</span>))) - source.begin());
<a name="l00946"></a>00946 }
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::radix(const Frame&amp; f) {
<a name="l00949"></a>00949         <span class="keywordtype">int</span> radix = f.get(STR(<span class="stringliteral">&quot;$1&quot;</span>));
<a name="l00950"></a>00950         <span class="keywordflow">if</span> (radix &lt; 2 || radix &gt; 16) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Radix out of range: &quot;</span>)) += intToString&lt;String&gt;(radix));
<a name="l00951"></a>00951         <span class="keywordtype">int</span> minLength = f.getOptional(STR(<span class="stringliteral">&quot;$2&quot;</span>), 1);
<a name="l00952"></a>00952         <span class="keywordflow">if</span> (minLength &lt; 0 || minLength &gt; <span class="keywordtype">int</span>(<span class="keyword">sizeof</span> (<span class="keywordtype">int</span>) * 8))
<a name="l00953"></a>00953                 <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Minimum length out of range: &quot;</span>)) += intToString&lt;String&gt;(minLength));
<a name="l00954"></a>00954         <span class="keywordflow">return</span> intToString&lt;String, ulong&gt;(f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>)), f.get(STR(<span class="stringliteral">&quot;$1&quot;</span>)), minLength);
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::save(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; file, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; chars) {
<a name="l00958"></a>00958         std::basic_ofstream&lt;Char&gt; outstream(toStdString(file).c_str());                                                                                                         <span class="comment">// Sorry, can&#39;t pass a wchar_t filename. MSVC supports it, but it is non-standard. So we convert to a std::string to be on the safe side.</span>
<a name="l00959"></a>00959         <span class="keywordflow">if</span> (!outstream.good()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Cannot open file for writing: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(file));
<a name="l00960"></a>00960         outstream.write(chars.data(), chars.size());
<a name="l00961"></a>00961         <span class="keywordflow">if</span> (outstream.bad()) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Error writing to file: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(file));
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964 TMPL ulong Script&lt;CFG&gt;::search(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; a, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; b) {
<a name="l00965"></a>00965         <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(std::search(a.begin(), a.end(), b.begin(), b.end()) - a.begin());
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968 TMPL ulong Script&lt;CFG&gt;::span(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; a, <span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; b) {
<a name="l00969"></a>00969         <span class="keyword">typename</span> String::const_iterator it;
<a name="l00970"></a>00970         <span class="keywordflow">for</span> (it = a.begin(); it != a.end() &amp;&amp; std::find(b.begin(), b.end(), *it) != b.end(); ++it);
<a name="l00971"></a>00971         <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>ulong<span class="keyword">&gt;</span>(it - a.begin());
<a name="l00972"></a>00972 }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>) Script&lt;CFG&gt;::precision(const Frame&amp; f) {
<a name="l00975"></a>00975         <span class="keywordflow">return</span> doubleToString&lt;String&gt;(f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>)), mini(maxi(<span class="keywordtype">long</span>(f.get(STR(<span class="stringliteral">&quot;$1&quot;</span>))), 1L), 16L));
<a name="l00976"></a>00976 }
<a name="l00977"></a>00977 
<a name="l00978"></a>00978 TMPL <span class="keywordtype">int</span> Script&lt;CFG&gt;::system(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp; command) {
<a name="l00979"></a>00979         <span class="keywordtype">int</span> xc = (command.empty() ? -1 : ::system(toStdString(command).c_str()));
<a name="l00980"></a>00980         <span class="keywordflow">if</span> (xc &lt; 0) <span class="keywordflow">throw</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(STR(<span class="stringliteral">&quot;Could not execute system command: &quot;</span>)) += <a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>(command));
<a name="l00981"></a>00981         <span class="keywordflow">return</span> xc;
<a name="l00982"></a>00982 }
<a name="l00983"></a>00983 
<a name="l00984"></a>00984 TMPL <span class="keywordtype">void</span> Script&lt;CFG&gt;::trace(<span class="keyword">const</span> Frame&amp; f) {
<a name="l00985"></a>00985         f.getRoot().setTracer(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77" title="Precedence levels are used both internally for the parser and externally for the tracing mechanism...">Precedence</a>(<span class="keywordtype">int</span>(f.getOptional(STR(<span class="stringliteral">&quot;$1&quot;</span>), <span class="keywordtype">int</span>(<a class="code" href="namespace_pika.html#a8a0370331c496817431591140d37bd77a85311b8af65bfa1dd363f210192e64b0" title="used only for tracing with tick()">TRACE_CALL</a>)))), f.getOptional(STR(<span class="stringliteral">&quot;$0&quot;</span>)));
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l00988"></a>00988 TMPL T_TYPE(<a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>) Script&lt;CFG&gt;::tryer(Frame&amp; f) {
<a name="l00989"></a>00989         <span class="keywordflow">try</span> { f.call(<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>(), f.get(STR(<span class="stringliteral">&quot;$0&quot;</span>)), 0); } <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a570b6081b5e9d008d8e734a43f94f89b" title="The exception type.">Xception</a>&amp; x) { <span class="keywordflow">return</span> x.getError(); }
<a name="l00990"></a>00990         <span class="keywordflow">return</span> <a class="code" href="struct_pika_1_1_script.html#a80fa30a8a1758bdd49dab50f00561809" title="The class used for all values and variables (defined by the configuration meta-class). E.g. STLValue.">Value</a>();
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a><a class="code" href="struct_pika_1_1_script.html#acaad877b0c81b04cc6e318eb527188fc">00993</a> TMPL <span class="keywordtype">void</span> <a class="code" href="struct_pika_1_1_script.html#acaad877b0c81b04cc6e318eb527188fc" title="Registers the standard native functions to frame. If includeIO is false, &amp;#39;load&amp;#39;, &amp;#39;save&amp;#39;, &amp;#39;input&amp;#39;, &amp;#39;print&amp;#39; and &amp;#39;system&amp;#39; will not be registered. Please, refer to the PikaScript standard library reference guide for more info on individual native functions.">Script&lt;CFG&gt;::addStandardNatives</a>(Frame&amp; f, <span class="keywordtype">bool</span> includeIO) {
<a name="l00994"></a>00994         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#a79d6f79cfb915910c85857eacc88bd57" title="Sets a variable value.">set</a>(STR(<span class="stringliteral">&quot;VERSION&quot;</span>), PIKA_SCRIPT_VERSION);
<a name="l00995"></a>00995         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#a79d6f79cfb915910c85857eacc88bd57" title="Sets a variable value.">set</a>(STR(<span class="stringliteral">&quot;run&quot;</span>), STR(<span class="stringliteral">&quot;&gt;::evaluate((&gt;{ $s = load($0); if ($s{:2} == &#39;#!&#39;) $s{find($s, \&quot;\\n\&quot;):} })($0), @$)&quot;</span>));        <span class="comment">// Note: we need this as a &quot;bootstrap&quot; to include &#39;stdlib.pika&#39;.</span>
<a name="l00996"></a>00996         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;abs&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(fabs));
<a name="l00997"></a>00997         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;acos&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(acos));
<a name="l00998"></a>00998         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;asin&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(asin));
<a name="l00999"></a>00999         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;atan&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(atan));
<a name="l01000"></a>01000         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;atan2&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>, <span class="keywordtype">double</span>))(atan2));
<a name="l01001"></a>01001         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;ceil&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(ceil));
<a name="l01002"></a>01002         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;char&quot;</span>), character);
<a name="l01003"></a>01003         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;cos&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(cos));
<a name="l01004"></a>01004         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;cosh&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(cosh));
<a name="l01005"></a>01005         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;delete&quot;</span>), deleter);
<a name="l01006"></a>01006         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;escape&quot;</span>), (<a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a> (*)(<span class="keyword">const</span> <a class="code" href="struct_pika_1_1_script.html#a51839e89b2f4af41673f57af9997e956" title="The class used for strings (defined by the string class). E.g. std::string.">String</a>&amp;))(<a class="code" href="namespace_pika.html#a6522fcd39dd453d7b4ad83419f3a41be" title="Depending on the contents of the source string s it is encoded either in single (&amp;#39; &amp;#39;) or doub...">escape</a>));
<a name="l01007"></a>01007         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;exists&quot;</span>), exists);
<a name="l01008"></a>01008         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;elevate&quot;</span>), <a class="code" href="struct_pika_1_1_script.html#ab83ca3cf9abeb9d9a80b6f41a619bd6d" title="Used to &amp;quot;aggregate&amp;quot; different method calls into a single function call.">elevate</a>);
<a name="l01009"></a>01009         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;evaluate&quot;</span>), evaluate);
<a name="l01010"></a>01010         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;exp&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(exp));
<a name="l01011"></a>01011         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;find&quot;</span>), find);
<a name="l01012"></a>01012         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;floor&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(floor));
<a name="l01013"></a>01013         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;foreach&quot;</span>), <span class="keywordflow">foreach</span>);
<a name="l01014"></a>01014         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#a79d6f79cfb915910c85857eacc88bd57" title="Sets a variable value.">set</a>(STR(<span class="stringliteral">&quot;include&quot;</span>), STR(<span class="stringliteral">&quot;&gt;::if (!exists(@::included[$0])) { ::included[$0] = true; run($0) }&quot;</span>));                                      <span class="comment">// Note: we need this as a &quot;bootstrap&quot; to include &#39;stdlib.pika&#39;.</span>
<a name="l01015"></a>01015         <span class="keywordflow">if</span> (includeIO) f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;input&quot;</span>), input);
<a name="l01016"></a>01016         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;invoke&quot;</span>), invoke);
<a name="l01017"></a>01017         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;length&quot;</span>), length);
<a name="l01018"></a>01018         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;log&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(log));
<a name="l01019"></a>01019         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;log10&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(log10));
<a name="l01020"></a>01020         <span class="keywordflow">if</span> (includeIO) f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;load&quot;</span>), load);
<a name="l01021"></a>01021         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;lower&quot;</span>), lower);
<a name="l01022"></a>01022         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;mismatch&quot;</span>), mismatch);
<a name="l01023"></a>01023         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;ordinal&quot;</span>), ordinal);
<a name="l01024"></a>01024         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;pow&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>, <span class="keywordtype">double</span>))(pow));
<a name="l01025"></a>01025         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;parse&quot;</span>), parse);
<a name="l01026"></a>01026         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;precision&quot;</span>), precision);
<a name="l01027"></a>01027         <span class="keywordflow">if</span> (includeIO) f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;print&quot;</span>), print);
<a name="l01028"></a>01028         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;radix&quot;</span>), radix);
<a name="l01029"></a>01029         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;random&quot;</span>), random);
<a name="l01030"></a>01030         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;reverse&quot;</span>), reverse);
<a name="l01031"></a>01031         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;sin&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(sin));
<a name="l01032"></a>01032         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;sinh&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(sinh));
<a name="l01033"></a>01033         <span class="keywordflow">if</span> (includeIO) f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;save&quot;</span>), save);
<a name="l01034"></a>01034         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;search&quot;</span>), search);
<a name="l01035"></a>01035         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;span&quot;</span>), span);
<a name="l01036"></a>01036         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;sqrt&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(sqrt));
<a name="l01037"></a>01037         <span class="keywordflow">if</span> (includeIO) f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;system&quot;</span>), system);
<a name="l01038"></a>01038         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;tan&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(tan));
<a name="l01039"></a>01039         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;tanh&quot;</span>), (<span class="keywordtype">double</span> (*)(<span class="keywordtype">double</span>))(tanh));
<a name="l01040"></a>01040         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;time&quot;</span>), time);
<a name="l01041"></a>01041         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;throw&quot;</span>), thrower);
<a name="l01042"></a>01042         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;trace&quot;</span>), trace);
<a name="l01043"></a>01043         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;try&quot;</span>), tryer);
<a name="l01044"></a>01044         f.<a class="code" href="class_pika_1_1_script_1_1_frame.html#ab621c832a9bd78f532389e31f34c1e9d" title="Registers the native function (or object) native with identifier in the appropriate variable space (d...">registerNative</a>(STR(<span class="stringliteral">&quot;upper&quot;</span>), upper);
<a name="l01045"></a>01045 }
<a name="l01046"></a>01046 
<a name="l01047"></a>01047 TMPL <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Native::~Native</a>() { }
<a name="l01048"></a><a class="code" href="class_pika_1_1_script_1_1_variables.html#a0b9b4eaba5d7f22994067a2c5a403472">01048</a> TMPL <a class="code" href="struct_pika_1_1_script.html" title="Script is a meta-class that groups all the core classes of the PikaScript interpreter together (excep...">Script&lt;CFG&gt;::Variables::~Variables</a>() { }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 <span class="preprocessor">#undef TMPL</span>
<a name="l01051"></a>01051 <span class="preprocessor"></span><span class="preprocessor">#undef T_TYPE</span>
<a name="l01052"></a>01052 <span class="preprocessor"></span><span class="preprocessor">#undef STR</span>
<a name="l01053"></a>01053 <span class="preprocessor"></span>
<a name="l01054"></a>01054 };
<a name="l01055"></a>01055 
<a name="l01056"></a>01056 <span class="preprocessor">#endif</span>
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed May 18 2011 02:17:25 for PikaScript by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
